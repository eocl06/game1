<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Gerçekten Yaşandı - Stabil & Modern</title>
    <style>
        /* ----- BEYAZ & MODERN TASARIM STİLLERİ - GELİŞMİŞ ÖZELLİKLER (Düzeltilmiş) ----- */
        @keyframes slowGradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes shakeAnimation {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            50% { transform: translateX(3px); }
            75% { transform: translateX(-2px); }
        }
        @keyframes correctFeedbackAnimation {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes confettiBurst {
            0% { transform: translateY(0) scale(0); opacity: 1; }
            100% { transform: translateY(-100px) scale(1.5); opacity: 0; }
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        :root {
            --bg-primary: #F4F6F8;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #E9ECEF;
            --bg-glass: rgba(250, 250, 250, 0.7); 
            --bg-image-placeholder: #DEE2E6;
            
            --text-primary: #1C1E21;
            --text-secondary: #555B63;
            --text-accent: #000000;
            --text-on-accent: #FFFFFF;

            --accent-red: #D92E2E;
            --accent-red-darker: #B02222;
            --accent-red-hover-bg: rgba(217, 46, 46, 0.08);
            
            --accent-green: #23A455;
            --accent-green-darker: #1C8042;
            
            --accent-grey: #6C757D;
            --accent-grey-darker: #5A6268;

            --font-family-main: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            --border-radius-main: 14px; 
            --border-radius-cards: 20px;
            --border-color: #CED4DA;

            --shadow-soft: 0 4px 15px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 8px 25px rgba(0, 0, 0, 0.07);
            --shadow-strong: 0 10px 30px rgba(0, 0, 0, 0.09);

            --question-time: 20s;
        }

        body {
            font-family: var(--font-family-main);
            margin: 0; padding: 0;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; overflow: hidden;
            touch-action: manipulation;
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }

        #game-container {
            width: 100%; max-width: 400px;
            height: 100vh; max-height: 820px;
            background-color: var(--bg-secondary);
            box-shadow: var(--shadow-strong);
            border-radius: var(--border-radius-main);
            overflow: hidden; position: relative;
            display: flex; flex-direction: column;
        }
        #game-container.shake { animation: shakeAnimation 0.3s ease-in-out; }
        #game-container.background-blur { filter: blur(3px); transition: filter 0.3s ease-out; }

        .screen {
            display: flex; opacity: 0; visibility: hidden;
            transform: translateY(15px) scale(0.99); 
            transition: opacity 0.45s cubic-bezier(0.4, 0, 0.2, 1), 
                        transform 0.45s cubic-bezier(0.4, 0, 0.2, 1),
                        visibility 0s 0.45s;
            flex-direction: column; align-items: center; justify-content: center;
            padding: 25px; box-sizing: border-box; text-align: center;
            width: 100%; height: 100%;
            position: absolute; top: 0; left: 0; z-index: 1;
        }
        .screen.active {
            opacity: 1; visibility: visible;
            transform: translateY(0) scale(1);
            transition-delay: 0s;
        }
        
        .content-box {
            background-color: var(--bg-secondary);
            padding: 30px; border-radius: var(--border-radius-cards);
            box-shadow: var(--shadow-medium); width: 95%; max-width: 380px;
            border: 1px solid var(--border-color);
        }

        h1, h2, h3 { font-weight: 700; letter-spacing: -0.5px; color: var(--text-accent); }
        h1 { font-size: 2.2em; margin-bottom: 20px; }
        h2 { font-size: 1.8em; margin-bottom: 18px; color: var(--accent-red); }
        h3 { font-size: 1.5em; margin-bottom: 15px; }
        p { color: var(--text-secondary); line-height: 1.6; font-size: 0.95em; }

        .btn {
            background-color: var(--accent-red); color: var(--text-on-accent);
            border: none; padding: 12px 25px; border-radius: var(--border-radius-main);
            font-size: 1.05em; font-weight: 600; cursor: pointer;
            transition: all 0.2s ease; margin: 10px 5px; box-shadow: var(--shadow-soft);
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn svg { width: 18px; height: 18px; fill: currentColor; }
        .btn:hover { background-color: var(--accent-red-darker); transform: translateY(-2px); box-shadow: var(--shadow-medium); }
        .btn:active { transform: translateY(0px) scale(0.98); box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }

        .btn.secondary {
             background-color: var(--bg-tertiary); color: var(--text-primary);
             border: 1px solid var(--border-color);
        }
        .btn.secondary:hover { background-color: #DDE1E5; border-color: #BCC1C7;}
        .btn.secondary:active { background-color: #D4D8DC;}
        .btn.small { padding: 8px 15px; font-size: 0.9em; }

        #onboarding-screen { z-index: 200; background-color: var(--bg-secondary); }
        .onboarding-carousel {
            display: flex; overflow-x: hidden; width: 100%;
            height: calc(100% - 120px); position: relative;
        }
        .onboarding-slide {
            min-width: 100%; height: 100%; display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 20px;
            box-sizing: border-box; transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
        }
        .onboarding-slide img { max-width: 150px; margin-bottom: 20px; }
        .onboarding-navigation {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px; width: calc(100% - 40px); position: absolute; bottom: 0;
        }
        .onboarding-dots { display: flex; gap: 8px; }
        .onboarding-dots .dot {
            width: 10px; height: 10px; background-color: var(--border-color);
            border-radius: 50%; transition: background-color 0.3s ease;
        }
        .onboarding-dots .dot.active { background-color: var(--accent-red); }
        #skip-onboarding-btn { color: var(--text-secondary); background: none; box-shadow: none; }

        .swipe-instructions-ingame {
            position: absolute; bottom: 0; left: 0; right: 0;
            background-color: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
            padding: 10px 0; border-top: 1px solid var(--border-color);
            box-shadow: 0 -4px 10px rgba(0,0,0,0.04); z-index: 15;
            font-size: 0.9em; color: var(--text-secondary); text-align: center;
        }

        #game-header {
            display: grid; grid-template-columns: auto 1fr auto;
            gap: 10px; align-items: center; width: 100%;
            padding: 10px 15px; box-sizing: border-box;
            position: absolute; top: 0; left: 0;
            background-color: rgba(255, 255, 255, 0.85); 
            backdrop-filter: blur(8px) saturate(120%); -webkit-backdrop-filter: blur(8px) saturate(120%);
            border-bottom: 1px solid var(--border-color);
            font-size: 0.8em; z-index: 10;
        }
        #tension-timer-container {
            height: 8px; background-color: var(--bg-tertiary);
            border-radius: 4px; overflow: hidden;
            grid-column: 2 / 3; margin: 0 10px;
        }
        #tension-progress-bar {
            width: 100%; height: 100%; background-color: var(--accent-red);
            border-radius: 4px; transition: width var(--question-time) linear;
        }
        #timer-text-display, #game-stats {
            color: var(--text-primary); font-weight: 600;
            padding: 5px 0; border-radius: 6px;
            white-space: nowrap; text-align: center;
        }
        #timer-text-display { grid-column: 1 / 2; text-align: left;}
        #game-stats { grid-column: 3 / 4; text-align: right; font-weight: 700; color: var(--accent-red); }

        #card-area {
            flex-grow: 1; display: flex; justify-content: center; align-items: center;
            width: 100%; perspective: 1800px;
            margin-top: 45px; margin-bottom: 50px;
            position: relative; padding: 0 15px; box-sizing: border-box;
        }

        .card {
            width: 100%; max-width: 350px; height: 88%; max-height: 620px;
            background-color: var(--bg-secondary); border-radius: var(--border-radius-cards);
            box-shadow: var(--shadow-strong); display: flex; flex-direction: column; 
            justify-content: flex-start; align-items: center; 
            padding: 18px; box-sizing: border-box; text-align: center;
            user-select: none; cursor: grab; position: absolute;
            border: 1px solid var(--border-color); opacity: 0;
            transform: perspective(1200px) translateY(20px) rotateX(30deg) scale(0.9);
            transform-origin: center top;
            transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1),
                        opacity 0.5s cubic-bezier(0.22, 1, 0.36, 1);
            z-index: 5;
        }
        .card.loaded {
             opacity: 1;
             transform: perspective(1200px) translateY(0px) rotateX(0deg) scale(1);
        }

        #news-meta-info {
            display: flex; flex-wrap: wrap; gap: 6px;
            margin-bottom: 12px; width: 100%; justify-content: center;
        }
        .meta-tag {
            font-size: 0.7em; padding: 3px 8px; background-color: var(--bg-tertiary);
            border-radius: 6px; color: var(--text-secondary); font-weight: 500;
            border: 1px solid var(--border-color);
        }
        .meta-tag .icon { margin-right: 4px; }

        #news-image-container {
            width: 100%; aspect-ratio: 1 / 1; overflow: hidden;
            border-radius: calc(var(--border-radius-cards) - 8px);
            margin-bottom: 15px; background-color: var(--bg-image-placeholder);
            box-shadow: inset 0 0 8px rgba(0,0,0,0.05); position: relative;
        }
        #news-image {
            display: block; width: 100%; height: 100%; object-fit: cover;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            opacity: 0; transform: scale(1.05);
        }
        #news-image.visible { opacity: 1; transform: scale(1); }
        #image-placeholder.loading-placeholder {
            display: flex; align-items: center; justify-content: center;
            width: 100%; height: 100%; background-color: var(--bg-image-placeholder);
            color: var(--text-secondary); font-size: 0.9em;
            position: absolute; top: 0; left: 0;
        }

        #news-headline {
            font-size: 1.1em; font-weight: 500; color: var(--text-primary); 
            line-height: 1.45; width: 100%; flex-grow: 1; overflow-y: auto; padding: 5px; 
            -webkit-overflow-scrolling: touch;
            &::-webkit-scrollbar { width: 6px; }
            &::-webkit-scrollbar-track { background: transparent; }
            &::-webkit-scrollbar-thumb { background-color: var(--accent-grey); border-radius: 10px; }
        }

        .card.swiping { transition: none !important; }
        .card.removing-left, .card.removing-right {
            transition: transform 0.4s cubic-bezier(0.7, 0, 0.84, 0), opacity 0.35s ease-out !important;
            opacity: 0 !important;
        }
        .card.removing-left { transform: translateX(-100px) scale(0.85) rotateZ(-10deg) !important; }
        .card.removing-right { transform: translateX(100px) scale(0.85) rotateZ(10deg) !important; }

        .feedback-popup {
            position: fixed; bottom: 0; left: 50%;
            transform: translateX(-50%) translateY(100%);
            width: 100%; max-width: 400px;
            background-color: var(--bg-glass); 
            backdrop-filter: blur(12px) saturate(120%); -webkit-backdrop-filter: blur(12px) saturate(120%);
            color: var(--text-primary); padding: 20px 25px 25px 25px;
            box-sizing: border-box; text-align: center; z-index: 100;
            border-top-left-radius: var(--border-radius-cards); border-top-right-radius: var(--border-radius-cards);
            box-shadow: 0 -6px 24px rgba(0,0,0,0.08);
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            border-top: 1px solid var(--border-color); 
        }
        .feedback-popup.visible { transform: translateX(-50%) translateY(0); }
        
        #feedback-confetti-anchor { position:absolute; top: -50px; left:50%; transform:translateX(-50%);}
        #feedback-text {
            font-size: 1.3em; font-weight: 600; margin-bottom: 15px; line-height: 1.4;
            opacity: 0; transform: translateY(10px);
        }
        .feedback-popup.visible #feedback-text {
            animation: correctFeedbackAnimation 0.5s 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        #feedback-text.correct { color: var(--accent-green); }
        #feedback-text.incorrect { color: var(--accent-red); }
        
        .confetti-dot {
            position: absolute; width: 8px; height: 8px;
            background-color: var(--accent-green); border-radius: 50%;
            opacity: 0; animation: confettiBurst 0.8s ease-out forwards;
        }

        #source-link, #explanation-text {
            display: block; margin: 12px auto; font-size: 0.95em;
            color: var(--text-secondary); max-width: 90%;
        }
        #source-link {
            color: var(--accent-red); text-decoration: none; font-weight: 500;
            padding: 8px 12px; border: 1px solid transparent;
            border-radius: var(--border-radius-main); display: inline-flex;
            align-items: center; gap: 6px;
            transition: all 0.2s ease;
        }
        #source-link:hover { background-color: var(--accent-red-hover-bg); border-color: var(--accent-red); }
        #source-link .spinner {
            display: inline-block; width: 14px; height: 14px;
            border: 2px solid rgba(0,0,0,0.1); border-left-color: var(--accent-red);
            border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 5px;
        }
        #explanation-text { font-style: italic; line-height: 1.5;}
        .hidden { display: none !important; }

        #result-screen p { font-size: 1.15em; margin: 12px 0; color: var(--text-primary); }
        #result-screen p .value { font-weight: 700; color: var(--accent-red); font-size: 1.2em; margin-left: 5px; }

        .stats-container { margin-top: 25px; width: 100%; }
        .stat-item { margin-bottom: 15px; }
        .stat-label { font-size: 0.9em; color: var(--text-secondary); margin-bottom: 5px; display: block; }
        .stat-bar-bg {
            width: 100%; height: 12px; background-color: var(--bg-tertiary);
            border-radius: 6px; overflow: hidden; border: 1px solid var(--border-color);
        }
        .stat-bar-fill {
            height: 100%; width: 0%;
            background-color: var(--accent-green); border-radius: 6px;
            transition: width 0.8s 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .stat-percentage { font-size: 0.9em; color: var(--accent-green); font-weight: 600; margin-left: 8px; }

        #score-list {
            list-style-type: none; padding: 0; max-height: 260px; overflow-y: auto;
            width: 100%; margin: 20px auto;
            &::-webkit-scrollbar { width: 6px; }
            &::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 10px;}
            &::-webkit-scrollbar-thumb { background-color: var(--accent-grey); border-radius: 10px; }
        }
        #score-list li {
            background-color: var(--bg-secondary);
            padding: 12px 15px; border-radius: 8px; margin-bottom: 8px;
            border: 1px solid var(--border-color);
            border-left: 3px solid var(--accent-red);
            font-size: 0.95em; display: flex; justify-content: space-between; align-items: center;
            transition: background-color 0.2s ease;
        }
        #score-list li:hover { background-color: var(--bg-tertiary); }
        #score-list li .date { font-size: 0.8em; color: var(--text-secondary); }
        
        @media (max-height: 750px) and (max-width: 400px) {
            h1 { font-size: 2em; } .card { padding: 15px; }
            #news-image-container { height: 160px; margin-bottom: 12px; }
            #news-headline { font-size: 1em; max-height: 90px; }
            .btn { padding: 10px 20px; font-size: 1em; }
            #game-header { font-size: 0.75em; padding: 8px 10px; gap: 5px; }
            #timer-text-display, #game-stats { padding: 4px 6px; }
            .swipe-instructions-ingame { bottom: 10px; padding: 8px 0; font-size: 0.85em; }
            .feedback-popup { padding: 18px 20px 20px 20px; }
            #feedback-text { font-size: 1.2em; }
            .onboarding-slide img { max-width: 120px; }
            .onboarding-slide h3 { font-size: 1.3em; }
            .onboarding-slide p { font-size: 0.9em; }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
</head>
<body>
    <svg width="0" height="0" style="position:absolute">
        <defs>
            <symbol id="icon-play" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></symbol>
            <symbol id="icon-restart" viewBox="0 0 24 24"><path d="M17.65 6.35A7.958 7.958 0 0 0 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></symbol>
            <symbol id="icon-trophy" viewBox="0 0 24 24"><path d="M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94A7.003 7.003 0 0 0 12 22a7.003 7.003 0 0 0 4.61-11.06C19.08 10.63 21 8.55 21 6V5c0-1.1-.9-2-2-2zm-9-1h4v1h-4V4zm7 7.26c-1.49.68-2.69 1.92-3.44 3.43A5.012 5.012 0 0 1 12 20a5.012 5.012 0 0 1-1.56-6.31c-.75-1.51-1.95-2.75-3.44-3.43C5.3 9.89 4 8.07 4 6V5.05C4 5.03 4.01 5 4.01 5H12h7.99c0 .02.01.03.01.05V6c0 2.07-1.3 3.89-3 4.26z"/></symbol>
            <symbol id="icon-share" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.18c.52.47 1.2.77 1.96.77 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.52 9.34 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.52-.34 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/></symbol>
            <symbol id="icon-next" viewBox="0 0 24 24"><path d="m12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8l-8-8z"/></symbol>
            <symbol id="icon-prev" viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></symbol>
            <symbol id="icon-home" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3L2 12h3v8h5z"/></symbol>
            <symbol id="icon-info" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"></path></symbol>
            <symbol id="icon-swipe" viewBox="0 0 24 24"><path d="M3.5 12.5c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5S5.83 11 5 11s-1.5.67-1.5 1.5zm4 0c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5S9.83 11 9 11s-1.5.67-1.5 1.5zm4 0c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5S13.83 11 13 11s-1.5.67-1.5 1.5zm9.48-3.16c-.04-.16-.09-.31-.15-.45l-2.61-6.3c-.2-.48-.65-.8-1.18-.8H7.47c-.53 0-.99.32-1.18.8l-2.61 6.3c-.06.14-.11.29-.15.45C1.01 10.63 0 12.73 0 15.59 0 19.13 2.87 22 6.41 22H17.6c3.53 0 6.4-2.87 6.4-6.41 0-2.86-1.01-4.96-2.52-6.25zM17.59 20H6.41C3.99 20 2 18.01 2 15.59c0-1.94.77-3.59 1.93-4.74.08-.08.16-.16.25-.24H7.6v2.79c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5V10.61h3.81v2.79c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5V10.61h3.42c.09.08.17.16.25.24 1.16 1.15 1.93 2.8 1.93 4.74 0 2.42-1.99 4.41-4.41 4.41zM10.18 8.61h3.64L12 4.21 10.18 8.61zM7.91 8.61l1.82-4.4L6.09 8.61h1.82zm5.99 0h1.82L13.9 4.21l1.82 4.4z"></path></symbol>
            <symbol id="icon-check" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"></path></symbol>
        </defs>
    </svg>

    <div id="game-container">
        <div id="onboarding-screen" class="screen">
            <div class="onboarding-carousel">
                <div class="onboarding-slide active" data-slide="0">
                    <svg width="80" height="80" style="fill: var(--accent-red); margin-bottom: 20px;"><use xlink:href="#icon-info"></use></svg>
                    <h3>Gerçekten Yaşandı'ya Hoş Geldin!</h3>
                    <p>Karşına çıkan absürt haberlerin gerçek mi yoksa uydurma mı olduğuna karar ver.</p>
                </div>
                <div class="onboarding-slide" data-slide="1">
                     <svg width="80" height="80" style="fill: var(--accent-red); margin-bottom: 20px;"><use xlink:href="#icon-swipe"></use></svg>
                    <h3>Nasıl Oynanır?</h3>
                    <p>Haber kartını <strong>sağa kaydırarak "Gerçek"</strong>, <strong>sola kaydırarak "Sahte"</strong> olduğunu belirt.</p>
                </div>
                <div class="onboarding-slide" data-slide="2">
                    <svg width="80" height="80" style="fill: var(--accent-red); margin-bottom: 20px;"><use xlink:href="#icon-trophy"></use></svg>
                    <h3>Puanlama ve Süre</h3>
                    <p>Her doğru cevap sana puan kazandırır. Hızlı karar vermek için bir "Gerilim Sayacın" olacak. Bakalım ne kadar dikkatlisin?</p>
                </div>
                <div class="onboarding-slide" data-slide="3">
                    <h3>Hemen Dene!</h3>
                    <p>"Bu haber sence gerçek mi?"</p>
                    <div id="onboarding-test-card" class="card loaded" style="position:relative; margin-top:20px; height: auto; min-height:180px; font-size:1em; padding:15px; box-shadow: var(--shadow-medium);">
                        <div id="onboarding-news-meta-info" style="font-size:0.8em; margin-bottom:10px;">
                             <span class="meta-tag">⏳ Şimdi</span> <span class="meta-tag">📍 Burada</span> <span class="meta-tag">💭 Deneme</span>
                        </div>
                        Bu bir deneme kartıdır. Sağa veya sola kaydırarak testi tamamla!
                    </div>
                    <p style="margin-top:15px; font-size:0.8em;">Bu kaydırma bir puanlama yapmayacak.</p>
                </div>
            </div>
            <div class="onboarding-navigation">
                <button id="prev-onboarding-btn" class="btn secondary small" style="visibility: hidden;"><svg><use xlink:href="#icon-prev"></use></svg>Geri</button>
                <div class="onboarding-dots">
                    <span class="dot active"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
                </div>
                <button id="next-onboarding-btn" class="btn small"><svg><use xlink:href="#icon-next"></use></svg>İleri</button>
                <button id="finish-onboarding-btn" class="btn small hidden"><svg><use xlink:href="#icon-check"></use></svg>Başla!</button>
            </div>
            <button id="skip-onboarding-btn" class="btn small" style="position:absolute; top:15px; right:15px; background:none; color:var(--text-secondary); box-shadow:none; padding:5px;">Atla</button>
        </div>

        <div id="start-screen" class="screen">
            <div class="content-box">
                <h1>Gerçekten Yaşandı</h1>
                <button id="start-button" class="btn"><svg><use xlink:href="#icon-play"></use></svg>Oyuna Başla</button>
                <p class="swipe-instructions">Sağa kaydır: Gerçek<br>Sola kaydır: Sahte</p>
            </div>
        </div>

        <div id="game-screen" class="screen">
            <div id="game-header">
                <div id="timer-text-display">Süre Yok</div>
                <div id="tension-timer-container"><div id="tension-progress-bar"></div></div>
                <div id="game-stats">D: 0 / S: 0</div>
            </div>
            <div id="card-area">
                <div id="news-card" class="card"></div>
            </div>
            <div id="feedback-area" class="feedback-popup hidden">
                <div id="feedback-confetti-anchor" style="position:absolute; top: -50px; left:50%; transform:translateX(-50%);"></div>
                <p id="feedback-text"></p>
                <a id="source-link" href="#" target="_blank" class="hidden">
                    <span class="link-text">📰 Kaynak Habere Git</span>
                    <span class="spinner hidden"></span>
                </a>
                <p id="explanation-text" class="hidden"></p>
                <button id="next-button" class="btn"><svg><use xlink:href="#icon-next"></use></svg>Devam Et</button>
            </div>
            <p class="swipe-instructions-ingame">Sağa: Gerçek / Sola: Sahte</p>
        </div>

        <div id="result-screen" class="screen">
            <div class="content-box">
                <h2>Oyun Bitti!</h2>
                <p id="final-correct">Toplam Doğru: <span class="value">0</span></p>
                <p id="time-taken">Toplam Süre: <span class="value">0s</span></p>
                <p id="calculated-score">Skorun: <span class="value">0</span></p>
                <div class="stats-container">
                    <div class="stat-item">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="stat-label">Doğruluk Oranın:</span>
                            <span id="correct-answer-percentage" class="stat-percentage">0%</span>
                        </div>
                        <div class="stat-bar-bg">
                            <div id="correct-answer-bar" class="stat-bar-fill"></div>
                        </div>
                    </div>
                </div>
                <button id="restart-button" class="btn"><svg><use xlink:href="#icon-restart"></use></svg>Tekrar Oyna</button>
                <button id="view-scores-button" class="btn secondary"><svg><use xlink:href="#icon-trophy"></use></svg>Skorları Gör</button>
                <button id="share-score-button" class="btn secondary"><svg><use xlink:href="#icon-share"></use></svg>Skorunu Paylaş</button>
            </div>
        </div>

        <div id="scoreboard-screen" class="screen">
            <div class="content-box">
                <h2><svg style="width:28px; height:28px; vertical-align: -4px; margin-right: 8px;"><use xlink:href="#icon-trophy"></use></svg>En Yüksek Skorlar</h2>
                <ul id="score-list"></ul>
                <button id="back-to-start-button" class="btn secondary"><svg><use xlink:href="#icon-home"></use></svg>Ana Ekrana Dön</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof Hammer === 'undefined') { console.error('Hammer.js kütüphanesi yüklenemedi!'); }

            const QUESTION_TIME_LIMIT = 20;
            const gameContainer = document.getElementById('game-container');
            const screens = {
                onboarding: document.getElementById('onboarding-screen'),
                start: document.getElementById('start-screen'),
                game: document.getElementById('game-screen'),
                result: document.getElementById('result-screen'),
                scoreboard: document.getElementById('scoreboard-screen')
            };
            const buttons = {
                prevOnboarding: document.getElementById('prev-onboarding-btn'),
                nextOnboarding: document.getElementById('next-onboarding-btn'),
                finishOnboarding: document.getElementById('finish-onboarding-btn'),
                skipOnboarding: document.getElementById('skip-onboarding-btn'),
                start: document.getElementById('start-button'),
                next: document.getElementById('next-button'),
                restart: document.getElementById('restart-button'),
                viewScores: document.getElementById('view-scores-button'),
                backToStart: document.getElementById('back-to-start-button'),
                shareScore: document.getElementById('share-score-button')
            };
            const displays = {
                timerText: document.getElementById('timer-text-display'),
                tensionProgressBar: document.getElementById('tension-progress-bar'),
                gameStats: document.getElementById('game-stats'),
                feedbackArea: document.getElementById('feedback-area'),
                feedbackText: document.getElementById('feedback-text'),
                sourceLink: document.getElementById('source-link'),
                sourceLinkText: document.querySelector('#source-link .link-text'),
                sourceLinkSpinner: document.querySelector('#source-link .spinner'),
                explanationText: document.getElementById('explanation-text'),
                finalCorrect: document.querySelector('#final-correct .value'),
                timeTaken: document.querySelector('#time-taken .value'),
                calculatedScore: document.querySelector('#calculated-score .value'),
                scoreList: document.getElementById('score-list'),
                correctAnswerBar: document.getElementById('correct-answer-bar'),
                correctAnswerPercentage: document.getElementById('correct-answer-percentage'),
                onboardingCarousel: document.querySelector('.onboarding-carousel'),
                onboardingSlides: document.querySelectorAll('.onboarding-slide'),
                onboardingDots: document.querySelectorAll('.onboarding-dots .dot')
            };
            const newsCardElement = document.getElementById('news-card');
            const onboardingTestCardElement = document.getElementById('onboarding-test-card');

            const newsItems = [
                { 
                    headline: "Konya’da Adam, Kendisini Aldatan Sevgilisini ChatGPT’ye Şikayet Etti. “Adalet artık yapay zekâda” sözleriyle gündem oldu.", 
                    isReal: false, 
                    explanation: "Bu haber uydurmadır. ChatGPT bir şikayet veya yargı mercii değildir.",
                    imageUrl: "https://source.unsplash.com/400x400/?sad,robot,court,konya",
                    date: "2024", location: "Konya", topic: "Yapay Zeka"
                },
                { 
                    headline: "Fatih'te sokakta yürüyen bir kişinin üzerine binanın çatısından çanak anten düştü. Hafif yaralanan adamın yardımına çevredekiler koştu.", 
                    isReal: true, 
                    source: "https://www.hurriyet.com.tr/video/fatihte-sokakta-yururken-uzerine-canak-anten-dustu-o-anlar-kamerada-42810547",
                    imageUrl: "https://source.unsplash.com/400x400/?istanbul,antenna,accident,street",
                    date: "2023", location: "İstanbul", topic: "Yaşam"
                },
                { 
                    headline: "Zonguldak’ta Belediye, Boş Arsaya ‘Görsel Olarak Düşünün’ Yazıp Açılış Yaptı. Arsaya kurdele keserek açılış yapan başkan, “İleri görüş budur” dedi.", 
                    isReal: false, 
                    explanation: "Bu haber uydurmadır. Bir belediye başkanının böyle bir açılış yapması gerçekçi değildir.",
                    imageUrl: "https://source.unsplash.com/400x400/?empty,sign,ceremony,zonguldak",
                    date: "2022", location: "Zonguldak", topic: "Mizah"
                },
                 { 
                    headline: "NEVŞEHİR'in Avanos İlçesi'nde kahvede okey oynayanların üzerine inek düştü.", 
                    isReal: true, 
                    source: "https://www.hurriyet.com.tr/gundem/okeycilerin-basina-inek-dustu-3434",
                    imageUrl: "https://source.unsplash.com/400x400/?cow,cafe,falling,nevsehir",
                    date: "2004", location: "Nevşehir", topic: "Hayvanlar"
                },
                { 
                    headline: "İstanbul'da bir kişi, ücretsiz aldığı ikinci el koltuğun içinde 600 bin lira buldu. Parayı bulan kişi, durumu yetkililere bildirdi.", 
                    isReal: true, 
                    source: "https://www.haberler.com/dunya/bedava-aldigi-koltuktan-600-bin-lira-para-cikti-14998707-",
                    explanation: "Not: Haber ABD kaynaklıdır ancak Türk basınında da yer bulmuştur.",
                    imageUrl: "https://source.unsplash.com/400x400/?money,couch,surprise,istanbul",
                    date: "2022", location: "ABD/İstanbul", topic: "Şans" 
                },
                { 
                    headline: "Sivas’ta Çoban, Sürüsüne Spotify Premium Alarak Müzik Dinletti. “Hayvanlar klasik müziğe daha sakin tepki veriyor” dedi.", 
                    isReal: false, 
                    explanation: "Bu haber uydurmadır. Hayvanların müzik zevki üzerine araştırmalar olsa da, bu durum kurgusaldır.",
                    imageUrl: "https://source.unsplash.com/400x400/?sheep,music,shepherd,sivas",
                    date: "2023", location: "Sivas", topic: "Teknoloji"
                },
                { 
                    headline: "Bir ahırda, ineklerin gaz çıkarması sonucu biriken metan gazı patlamaya neden oldu.", 
                    isReal: true, 
                    source: "https://onedio.com/haber/inekler-gaz-cikardi-ahir-patladi-243426",
                    imageUrl: "https://source.unsplash.com/400x400/?cow,explosion,barn,germany",
                    date: "2014", location: "Almanya", topic: "Bilim"
                }
            ];
            let currentNewsIndex = 0;
            let score = 0;
            let correctAnswers = 0;
            let questionTimerInterval;
            let questionTimeLeft = QUESTION_TIME_LIMIT;
            let totalGameSecondsElapsed = 0;
            let gameTimerInterval; // Toplam oyun süresi için

            let gameActive = false;
            let shuffledNews = [];
            let mainHammerInstance;
            let onboardingHammerInstance;

            let currentOnboardingSlide = 0;
            function showOnboardingSlide(index) {
                if (!displays.onboardingSlides || !displays.onboardingDots || !buttons.prevOnboarding || !buttons.nextOnboarding || !buttons.finishOnboarding) return;
                displays.onboardingSlides.forEach((slide, i) => {
                    slide.style.transform = `translateX(-${index * 100}%)`;
                    if(displays.onboardingDots[i]) displays.onboardingDots[i].classList.toggle('active', i === index);
                });
                buttons.prevOnboarding.style.visibility = (index === 0) ? 'hidden' : 'visible';
                buttons.nextOnboarding.classList.toggle('hidden', index === displays.onboardingSlides.length - 1);
                buttons.finishOnboarding.classList.toggle('hidden', index !== displays.onboardingSlides.length - 1);
                currentOnboardingSlide = index;

                if (index === displays.onboardingSlides.length - 1 && onboardingTestCardElement) {
                    setupOnboardingSwipe();
                } else if (onboardingHammerInstance) {
                    onboardingHammerInstance.destroy();
                    onboardingHammerInstance = null;
                }
            }

            function setupOnboardingSwipe() {
                if (typeof Hammer === 'undefined' || !onboardingTestCardElement) return;
                if (onboardingHammerInstance) onboardingHammerInstance.destroy();
                onboardingHammerInstance = new Hammer(onboardingTestCardElement);
                onboardingHammerInstance.get('pan').set({ direction: Hammer.DIRECTION_HORIZONTAL, threshold: 20 });
                onboardingTestCardElement.style.transform = 'translateX(0px) rotateZ(0deg)';
                onboardingHammerInstance.on('panmove', (ev) => {
                    onboardingTestCardElement.style.transform = `translateX(${ev.deltaX}px) rotateZ(${ev.deltaX / 20}deg)`;
                });
                onboardingHammerInstance.on('panend', (ev) => {
                    if (Math.abs(ev.deltaX) > 50) {
                        onboardingTestCardElement.style.transition = 'transform 0.3s ease-out, opacity 0.3s ease-out';
                        onboardingTestCardElement.style.transform = `translateX(${ev.deltaX > 0 ? 300 : -300}px) rotateZ(${ev.deltaX > 0 ? 20 : -20}deg)`;
                        onboardingTestCardElement.style.opacity = '0';
                        setTimeout(() => { if(buttons.finishOnboarding) buttons.finishOnboarding.focus(); }, 300);
                    } else {
                        onboardingTestCardElement.style.transition = 'transform 0.3s ease-out';
                        onboardingTestCardElement.style.transform = 'translateX(0px) rotateZ(0deg)';
                    }
                });
            }

            function finishOnboarding() {
                localStorage.setItem('onboardingComplete_v3', 'true');
                showScreen('start');
            }

            if (buttons.nextOnboarding) buttons.nextOnboarding.addEventListener('click', () => { if (currentOnboardingSlide < displays.onboardingSlides.length - 1) showOnboardingSlide(currentOnboardingSlide + 1); });
            if (buttons.prevOnboarding) buttons.prevOnboarding.addEventListener('click', () => { if (currentOnboardingSlide > 0) showOnboardingSlide(currentOnboardingSlide - 1); });
            if (buttons.finishOnboarding) buttons.finishOnboarding.addEventListener('click', finishOnboarding);
            if (buttons.skipOnboarding) buttons.skipOnboarding.addEventListener('click', finishOnboarding);

            function setupMainSwipeControls() {
                if (typeof Hammer === 'undefined' || !newsCardElement) return;
                if (mainHammerInstance) { mainHammerInstance.destroy(); }
                mainHammerInstance = new Hammer(newsCardElement);
                mainHammerInstance.get('pan').set({ direction: Hammer.DIRECTION_HORIZONTAL, threshold: 30 });
                newsCardElement.style.transform = ''; newsCardElement.style.transition = '';
                mainHammerInstance.on('panstart', () => {
                    if (!gameActive || displays.feedbackArea.classList.contains('visible')) return;
                    newsCardElement.classList.add('swiping');
                    if (gameContainer) gameContainer.classList.add('background-blur');
                });
                mainHammerInstance.on('panmove', (ev) => {
                    if (!gameActive || !newsCardElement.classList.contains('swiping')) return;
                    const x = ev.deltaX;
                    const rotation = x / 20; 
                    const scale = 1 - Math.abs(x / (newsCardElement.offsetWidth * 3));
                    newsCardElement.style.transform = `translateX(${x}px) rotateZ(${rotation}deg) scale(${Math.max(scale, 0.97)})`;
                    newsCardElement.style.opacity = 1 - Math.abs(x / (newsCardElement.offsetWidth * 2)); 
                });
                mainHammerInstance.on('panend', (ev) => {
                    if (!gameActive || !newsCardElement.classList.contains('swiping')) return;
                    newsCardElement.classList.remove('swiping');
                    if (gameContainer) gameContainer.classList.remove('background-blur');
                    newsCardElement.style.opacity = ''; 
                    const swipeThreshold = newsCardElement.offsetWidth * 0.35; 
                    if (Math.abs(ev.deltaX) > swipeThreshold) {
                        handleSwipe(ev.deltaX > 0 ? 'right' : 'left');
                    } else {
                        newsCardElement.style.transition = 'transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.3s ease';
                        newsCardElement.style.transform = 'translateX(0px) rotateZ(0deg) scale(1)';
                        newsCardElement.style.opacity = '1';
                        setTimeout(() => { newsCardElement.style.transition = ''; }, 300);
                    }
                });
            }

            function showScreen(screenId) {
                Object.values(screens).forEach(screen => { if(screen) screen.classList.remove('active');});
                if (screens[screenId]) {
                    screens[screenId].classList.add('active');
                } else {
                    console.error("Ekran bulunamadı:", screenId);
                }
            }

            function startQuestionTimer() {
                questionTimeLeft = QUESTION_TIME_LIMIT;
                if(displays.tensionProgressBar) {
                    displays.tensionProgressBar.style.transition = 'none';
                    displays.tensionProgressBar.style.width = '100%';
                }
                if(displays.timerText) displays.timerText.textContent = `${questionTimeLeft}s`;
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        if(displays.tensionProgressBar) {
                            displays.tensionProgressBar.style.transition = `width ${QUESTION_TIME_LIMIT}s linear`;
                            displays.tensionProgressBar.style.width = '0%';
                        }
                    });
                });
                if (questionTimerInterval) clearInterval(questionTimerInterval);
                questionTimerInterval = setInterval(() => {
                    questionTimeLeft--;
                    if(displays.timerText) displays.timerText.textContent = `${questionTimeLeft}s`;
                    if (questionTimeLeft <= 0) {
                        clearInterval(questionTimerInterval);
                        if (gameActive) {
                            handleSwipe('timeout');
                        }
                    }
                }, 1000);
            }
            function stopQuestionTimer() {
                clearInterval(questionTimerInterval);
                if(displays.tensionProgressBar) {
                    const currentWidth = displays.tensionProgressBar.offsetWidth;
                    const parentWidth = displays.tensionProgressBar.parentElement ? displays.tensionProgressBar.parentElement.offsetWidth : 1; // Parent yoksa veya genişliği 0 ise 1 al
                    displays.tensionProgressBar.style.transition = 'none';
                    displays.tensionProgressBar.style.width = parentWidth > 0 ? `${(currentWidth / parentWidth) * 100}%` : '0%';
                }
            }
            
            function startGameTimer() {
                totalGameSecondsElapsed = 0;
                if (gameTimerInterval) clearInterval(gameTimerInterval);
                gameTimerInterval = setInterval(() => {
                    totalGameSecondsElapsed++;
                }, 1000);
            }
            function stopGameTimer() { clearInterval(gameTimerInterval); }

            function calculateCurrentScore() { return correctAnswers * 100; }
            function finalScoreFormula(correct, time) {
                if (time <= 0) return correct * 10000;
                return Math.round((correct * 10000) / (time + 1)); 
            }

            function updateGameHeader() {
                const questionNumToShow = gameActive ? currentNewsIndex + 1 : 0;
                const totalQuestions = shuffledNews.length > 0 ? shuffledNews.length : newsItems.length;
                
                if (displays.gameStats) {
                     displays.gameStats.textContent = `D: ${correctAnswers} / S: ${totalQuestions}`;
                }
                // Skor ayrıca güncellenecek (veya buraya eklenebilir)
            }

            function createConfetti() {
                if (!displays.feedbackArea) return;
                const confettiAnchor = document.getElementById('feedback-confetti-anchor');
                if (!confettiAnchor) return;
                for (let i = 0; i < 15; i++) {
                    const dot = document.createElement('div');
                    dot.classList.add('confetti-dot');
                    dot.style.left = `${Math.random() * 60 - 30}px`;
                    dot.style.animationDelay = `${Math.random() * 0.2}s`;
                    dot.style.backgroundColor = `hsl(${Math.random() * 60 + 90}, 70%, 60%)`;
                    confettiAnchor.appendChild(dot);
                    setTimeout(() => dot.remove(), 1000);
                }
            }

            function loadNewsCard() {
                if (!newsCardElement) return;
                newsCardElement.classList.remove('loaded', 'removing-left', 'removing-right', 'swiping');
                newsCardElement.style.transform = ''; newsCardElement.style.opacity = '';
                newsCardElement.innerHTML = '';

                if (currentNewsIndex < shuffledNews.length) {
                    const newsItem = shuffledNews[currentNewsIndex];
                    
                    // Soru sayısını burada güncelle, çünkü kart yeni yükleniyor
                    if (displays.gameStats) displays.gameStats.textContent = `D: ${correctAnswers} / S: ${shuffledNews.length}`;
                    if (displays.score) displays.score.textContent = `Skor: ${score}`; // Skoru da göster

                    startQuestionTimer();

                    const metaInfoDiv = document.createElement('div');
                    metaInfoDiv.id = 'news-meta-info';
                    if (newsItem.date) metaInfoDiv.innerHTML += `<span class="meta-tag"><span class="icon">⏳</span> ${newsItem.date}</span>`;
                    if (newsItem.location) metaInfoDiv.innerHTML += `<span class="meta-tag"><span class="icon">📍</span> ${newsItem.location}</span>`;
                    if (newsItem.topic) metaInfoDiv.innerHTML += `<span class="meta-tag"><span class="icon">💭</span> ${newsItem.topic}</span>`;
                    newsCardElement.appendChild(metaInfoDiv);

                    const imageContainer = document.createElement('div');
                    imageContainer.id = 'news-image-container';
                    const newsImage = document.createElement('img');
                    newsImage.id = 'news-image';
                    let placeholder = document.createElement('div');
                    placeholder.id = 'image-placeholder'; 
                    placeholder.classList.add('loading-placeholder');
                    imageContainer.appendChild(placeholder);
                    newsImage.onload = () => { placeholder.style.display = 'none'; newsImage.classList.add('visible'); };
                    newsImage.onerror = () => { placeholder.textContent = 'Görsel Yüklenemedi';};
                    if (newsItem.imageUrl) newsImage.src = newsItem.imageUrl; else placeholder.textContent = 'Görsel Yok';
                    imageContainer.appendChild(newsImage);
                    newsCardElement.appendChild(imageContainer);

                    const headlineDiv = document.createElement('div');
                    headlineDiv.id = 'news-headline';
                    headlineDiv.textContent = newsItem.headline;
                    newsCardElement.appendChild(headlineDiv);
                    
                    requestAnimationFrame(() => {
                        requestAnimationFrame(() => {
                           if (newsCardElement) newsCardElement.classList.add('loaded');
                           setupMainSwipeControls();
                        });
                    });
                } else {
                    endGame();
                }
            }
            
            function handleSwipe(directionOrReason) {
                if (!gameActive) return;
                gameActive = false; 
                stopQuestionTimer();

                if (directionOrReason === 'timeout') {
                    if(newsCardElement) newsCardElement.classList.add('removing-left'); 
                } else if (newsCardElement) {
                     newsCardElement.classList.add(directionOrReason === 'right' ? 'removing-right' : 'removing-left');
                }
                
                const newsItem = shuffledNews[currentNewsIndex];
                let userChoiceIsReal;
                if (directionOrReason === 'timeout') { userChoiceIsReal = null; } 
                else { userChoiceIsReal = (directionOrReason === 'right'); }
                
                setTimeout(() => {
                    processAnswer(userChoiceIsReal, newsItem, directionOrReason === 'timeout');
                }, newsCardElement ? 450 : 0);
            }

            function processAnswer(userChoiceIsReal, newsItem, timedOut = false) {
                let correct = false;
                if (!timedOut) { correct = (userChoiceIsReal === newsItem.isReal); }

                if (displays.feedbackArea) { displays.feedbackArea.classList.remove('hidden'); displays.feedbackArea.classList.add('visible'); }
                if (displays.sourceLink) displays.sourceLink.classList.add('hidden');
                if (displays.explanationText) displays.explanationText.classList.add('hidden');

                if (correct) {
                    correctAnswers++;
                    score = calculateCurrentScore();
                    if (displays.feedbackText) {
                        displays.feedbackText.textContent = "Doğru! 👍";
                        displays.feedbackText.className = 'correct';
                        createConfetti();
                    }
                    if (newsItem.isReal) {
                        if (displays.feedbackText) displays.feedbackText.textContent += " Bu gerçekten yaşandı!";
                        if (newsItem.source && displays.sourceLink) { displays.sourceLink.href = newsItem.source; displays.sourceLink.classList.remove('hidden'); }
                    } else {
                         if (displays.feedbackText) displays.feedbackText.textContent += " Bu uydurma bir haberdi.";
                        if (newsItem.explanation && displays.explanationText) { displays.explanationText.textContent = newsItem.explanation; displays.explanationText.classList.remove('hidden'); }
                    }
                } else {
                    if (displays.feedbackText) {
                        displays.feedbackText.textContent = timedOut ? "Süre Doldu! 😟" : "Yanlış! 👎";
                        displays.feedbackText.className = 'incorrect';
                        if(gameContainer && !timedOut) gameContainer.classList.add('shake');
                        setTimeout(()=> { if(gameContainer) gameContainer.classList.remove('shake'); }, 300);
                    }
                    if (!timedOut) {
                        if (newsItem.isReal) {
                           if (displays.feedbackText) displays.feedbackText.textContent += " Bu aslında gerçek bir haberdi.";
                            if (newsItem.source && displays.sourceLink) { displays.sourceLink.href = newsItem.source; displays.sourceLink.classList.remove('hidden'); }
                        } else {
                           if (displays.feedbackText) displays.feedbackText.textContent += " Bu haber uydurmaydı.";
                            if (newsItem.explanation && displays.explanationText) { displays.explanationText.textContent = newsItem.explanation; displays.explanationText.classList.remove('hidden');}
                        }
                    }
                }
                // Her cevap sonrası header'ı güncelle
                if (displays.gameStats) displays.gameStats.textContent = `D: ${correctAnswers} / S: ${shuffledNews.length}`;
                if (displays.score) displays.score.textContent = `Skor: ${score}`;
            }

            function nextNewsItem() {
                if (displays.feedbackArea) {
                     displays.feedbackArea.classList.remove('visible');
                     setTimeout(() => { displays.feedbackArea.classList.add('hidden');}, 400);
                }
                currentNewsIndex++;
                if (currentNewsIndex < shuffledNews.length) {
                    gameActive = true;
                    loadNewsCard();
                } else {
                    endGame();
                }
            }

            function startGame() {
                shuffledNews = [...newsItems];
                shuffledNews = shuffledNews.slice(0, Math.min(10, shuffledNews.length));

                currentNewsIndex = 0; score = 0; correctAnswers = 0;
                totalGameSecondsElapsed = 0; // Toplam oyun süresini sıfırla
                
                if (displays.feedbackArea) { displays.feedbackArea.classList.add('hidden'); displays.feedbackArea.classList.remove('visible');}
                
                if (displays.gameStats) displays.gameStats.textContent = `D: 0 / S: ${shuffledNews.length}`; // Başlangıçta toplam soru sayısını göster
                if (displays.score) displays.score.textContent = `Skor: 0`;
                
                loadNewsCard(); 
                startGameTimer(); // Toplam oyun süresini başlat
                showScreen('game');
                gameActive = true;
            }

            function endGame() {
                gameActive = false;
                stopQuestionTimer();
                stopGameTimer(); // Toplam oyun süresini durdur
                
                const totalQuestionsAttempted = shuffledNews.length;
                const percentage = totalQuestionsAttempted > 0 ? Math.round((correctAnswers / totalQuestionsAttempted) * 100) : 0;

                if (displays.finalCorrect) displays.finalCorrect.textContent = correctAnswers;
                if (displays.timeTaken) displays.timeTaken.textContent = `${totalGameSecondsElapsed}s`; // Gerçek geçen süreyi göster
                
                const finalCalcScore = finalScoreFormula(correctAnswers, totalGameSecondsElapsed);
                if (displays.calculatedScore) displays.calculatedScore.textContent = finalCalcScore;

                if(displays.correctAnswerBar) displays.correctAnswerBar.style.width = `${percentage}%`;
                if(displays.correctAnswerPercentage) displays.correctAnswerPercentage.textContent = `${percentage}%`;

                saveScoreToLocalStorage(finalCalcScore, correctAnswers, totalGameSecondsElapsed);
                showScreen('result');
            }

            function saveScoreToLocalStorage(playerScore, correct, time) {
                const scores = getScoresFromLocalStorage();
                const newScoreEntry = { 
                    score: playerScore, correct: correct, time: time, 
                    date: new Date().toLocaleDateString('tr-TR', { day: '2-digit', month: 'short', year: 'numeric' }) 
                };
                scores.push(newScoreEntry);
                scores.sort((a, b) => b.score - a.score);
                localStorage.setItem('gercektenYasandiScores_vFinal', JSON.stringify(scores.slice(0, 5))); // Yeni key
            }

            function getScoresFromLocalStorage() {
                const scores = localStorage.getItem('gercektenYasandiScores_vFinal');
                return scores ? JSON.parse(scores) : [];
            }

            function displayScoreboard() { /* ... önceki gibi ... */
                const scores = getScoresFromLocalStorage();
                if (displays.scoreList) {
                    displays.scoreList.innerHTML = '';
                    if (scores.length === 0) {
                        displays.scoreList.innerHTML = '<li>Henüz kayıtlı skor yok.</li>';
                    } else {
                        scores.forEach(entry => {
                            const li = document.createElement('li');
                            li.innerHTML = `<span>Skor: ${entry.score} (D:${entry.correct}, S:${entry.time}s)</span> <span class="date">${entry.date}</span>`;
                            displays.scoreList.appendChild(li);
                        });
                    }
                }
                showScreen('scoreboard');
            }


            function shareScore() { /* ... önceki gibi ... */ 
                const shareText = `Gerçekten Yaşandı oyununda ${displays.calculatedScore ? displays.calculatedScore.textContent : 'bir'} puan aldım! Sen de oyna!`;
                if (navigator.share) {
                    navigator.share({
                        title: 'Gerçekten Yaşandı Skor', text: shareText, url: window.location.href
                    }).catch((error) => {
                        console.warn('Paylaşım API hatası veya iptal:', error);
                        prompt("Skorunu kopyala ve paylaş:", shareText);
                      });
                } else {
                    prompt("Skorunu kopyala ve paylaş:", shareText);
                }
            }
            
            function safelyAddEventListener(button, event, handler) {
                if (button) button.addEventListener(event, handler);
            }

            safelyAddEventListener(buttons.start, 'click', startGame);
            safelyAddEventListener(buttons.next, 'click', nextNewsItem);
            safelyAddEventListener(buttons.restart, 'click', startGame);
            safelyAddEventListener(buttons.viewScores, 'click', displayScoreboard);
            safelyAddEventListener(buttons.backToStart, 'click', () => showScreen('start'));
            safelyAddEventListener(buttons.shareScore, 'click', shareScore);

            if (displays.sourceLink) {
                displays.sourceLink.addEventListener('click', function() {
                    if(displays.sourceLinkText) displays.sourceLinkText.textContent = "Yönlendiriliyor...";
                    if(displays.sourceLinkSpinner) displays.sourceLinkSpinner.classList.remove('hidden');
                    setTimeout(() => {
                        if(displays.sourceLinkText) displays.sourceLinkText.textContent = "📰 Kaynak Habere Git";
                        if(displays.sourceLinkSpinner) displays.sourceLinkSpinner.classList.add('hidden');
                    }, 3000);
                });
            }

            const onboardingComplete = localStorage.getItem('onboardingComplete_v3');
            if (!onboardingComplete) {
                showScreen('onboarding');
                showOnboardingSlide(0);
            } else {
                showScreen('start');
            }
        });
    </script>
</body>
</html>
