<!DOCTYPE html>
<html>
<head>
<meta charset="utf-utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&family=Lexend%3Awght%40400%3B500%3B600%3B700%3B800%3B900&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
<title>Fake or Take? - Gerçek mi Sahte mi?</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<style>
.material-icons, .material-icons-outlined { font-size: 28px; vertical-align: middle; }
.material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; font-size: 24px; vertical-align: middle; }
.btn-primary { background-color: #3B82F6; color: white; }
.btn-secondary { background-color: #E5E7EB; color: #1F2937; }
.lexend-font { font-family: 'Lexend', "Noto Sans", sans-serif; }
.card-gradient { background-image: linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.6) 70%, rgba(0, 0, 0, 0.8) 100%); }
.primary-color-text { color: #0c7ff2; }
.primary-color-bg { background-color: #0c7ff2; }
.news-button-disabled { opacity: 0.6; pointer-events: none; }
.correct-feedback { background-color: #EBF9F0; border-left: 4px solid #34D399; }
.incorrect-feedback { background-color: #FEE2E2; border-left: 4px solid #F87171; }
.status-icon-correct { color: #34D399; }
.status-icon-incorrect { color: #F87171; }
.timeup-icon { color: #F59E0B; }

#appRoot { overflow-y: hidden; }
body.loading #appRoot > .main-screen-view { opacity: 0; transition: none !important; }
.main-screen-view { opacity: 1; transform: translateY(0); transition: opacity 0.4s ease-out, transform 0.4s ease-out; }
.main-screen-view.hidden { opacity: 0 !important; transform: translateY(20px) !important; pointer-events: none; display: none !important; }

.nav-item-active span:first-child { color: #0b80ee; transform: scale(1.1); transition: transform 0.2s ease-in-out; }
.nav-item-active span:last-child { color: #0b80ee; font-weight: 600; }
.btn-animated { transition: transform 0.1s ease-in-out, background-color 0.1s; }
.btn-animated:active { transform: scale(0.96); }
.feedback-content-appear { animation: scaleUpSpring 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
@keyframes scaleUpSpring { from { opacity: 0; transform: scale(0.7); } to { opacity: 1; transform: scale(1); } }
.timer-pulse { animation: pulseTimerWarn 1s infinite ease-in-out; }
@keyframes pulseTimerWarn { 0%, 100% { transform: scale(1); color: inherit; } 50% { transform: scale(1.15); color: #ef4444; } } /* Pulse rengi Tailwind red-500 ile uyumlu #ef4444 */

#newsCardContainer { position: relative; width: 100%; max-width: calc(100% - 2rem); margin-left: auto; margin-right: auto; aspect-ratio: 3 / 4; min-height: 380px; sm:min-height: 450px; overflow: visible; }
#newsCard { position: absolute; top: 0; left: 0; right: 0; bottom: 0; cursor: grab; user-select: none; touch-action: pan-y; transition: transform 0.3s ease-out; will-change: transform, opacity; background-color: #f3f4f6; border-radius: 1rem; /* rounded-2xl */ overflow:hidden; /* Resim taşmaması için */ }
#newsCard.swiping { cursor: grabbing; transition: none; }
.swipe-decision-indicator { position: absolute; top: 30px; padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 1.25rem; font-weight: 700; color: white; border: 3px solid white; opacity: 0; transform: rotate(-15deg) scale(0.8); transition: opacity 0.3s ease-out, transform 0.3s ease-out; z-index: 10; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
.swipe-decision-indicator.real-indicator { background-color: rgba(5, 150, 105, 0.85); left: 30px; transform: rotate(-25deg) scale(0.8); }
.swipe-decision-indicator.fake-indicator { background-color: rgba(220, 38, 38, 0.85); right: 30px; transform: rotate(25deg) scale(0.8); }
.swipe-decision-indicator.visible { opacity: 1; transform: rotate(-15deg) scale(1.1); }
.swipe-decision-indicator.fake-indicator.visible { transform: rotate(15deg) scale(1.1); }

@keyframes cardFlyOutLeftAnim { 0% { transform: translateX(0) rotate(0deg) scale(1); opacity: 1; } 100% { transform: translateX(-130vw) rotate(-40deg) scale(0.7); opacity: 0; } }
@keyframes cardFlyOutRightAnim { 0% { transform: translateX(0) rotate(0deg) scale(1); opacity: 1; } 100% { transform: translateX(130vw) rotate(40deg) scale(0.7); opacity: 0; } }
#newsCard.fly-out-left { animation: cardFlyOutLeftAnim 0.4s cubic-bezier(0.6, -0.28, 0.735, 0.045) forwards; }
#newsCard.fly-out-right { animation: cardFlyOutRightAnim 0.4s cubic-bezier(0.6, -0.28, 0.735, 0.045) forwards; }

@keyframes cardEnterAnim { to { transform: translateY(0) scale(1) rotateX(0deg); opacity: 1; } }
#newsCard.enter-anim { visibility: hidden; opacity: 0; transform: translateY(60px) scale(0.95) rotateX(-15deg); }
#newsCard.enter-anim.active { visibility: visible; animation: cardEnterAnim 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }

html, body {
  height: 100%;
  overflow: hidden;
  margin: 0;
  padding: 0;
}
</style>
</head>
<body class="bg-slate-50 lexend-font loading">
<div id="appRoot" class="relative flex size-full flex-col group/design-root overflow-x-hidden">

<div id="homeScreen" class="main-screen-view flex flex-col h-full">
<header id="homeHeader" class="bg-white shadow-sm sticky top-0 z-20">
<div class="container mx-auto px-4 py-3 flex items-center justify-between">
  <div class="w-10"></div>
  <h1 class="text-xl font-bold text-slate-800 text-center flex-1">Fake or Take?</h1>
  <div class="w-10 flex justify-end">
    <button class="flex items-center justify-center rounded-full h-10 w-10 text-slate-600 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 btn-animated">
      <span class="material-icons">settings</span>
    </button>
  </div>
</div>
</header>
<main id="homeMain" class="flex-grow container mx-auto px-6 py-8 text-center overflow-y-auto">
<div class="max-w-md mx-auto">
<img alt="Fake or Take? Uygulama İkonu" class="w-24 h-24 mx-auto mb-6 rounded-2xl shadow-lg" src="https://lh3.googleusercontent.com/aida-public/AB6AXuA-fyUmZiKE_nHNvrPBkaFU8b7xUACLQqHF6tcg8JvnK5Q6c6jPl3YmzTHiKo_1obIExV7JX4I7-RwqTrwTlDjr3jOk6evMGA_LsZZJqffZTDzErZ_HID38KBy94n4llusld-zy1HQGA6Vh60LEgx5n42La1umYxi6ix0kaC2sMngn_puvstBZscr-hOff8pSDIQZ6mr68JnYKwqbxfEF-BKh-Ra7riGUwcTQ9ACW7YYGk29y9OHCMUBDyMu4TRx8h8D9O5pafdDLfV"/>
<h2 class="text-3xl sm:text-4xl font-bold text-slate-800 mb-3">Gerçek Bir Gündem Kurdu musun?</h2>
<p class="text-lg sm:text-xl text-slate-600 mb-10">Öyleyse hodri meydan! "Bu kadar da olmaz!" dediğin anlar olacak, eminiz. Ama acaba hangisi gerçek, hangisi aldatmaca?</p>
<div class="space-y-4">
<button id="playNowBtn" class="btn-primary btn-animated w-full flex items-center justify-center rounded-xl h-14 px-6 text-lg font-semibold shadow-md hover:bg-blue-700 transition-colors duration-150">
<span class="material-icons mr-2">play_arrow</span>Hemen Oyna
</button>
<button id="leaderboardBtnHome" class="btn-secondary btn-animated w-full flex items-center justify-center rounded-xl h-14 px-6 text-lg font-semibold shadow-sm hover:bg-slate-200 transition-colors duration-150">
<span class="material-icons mr-2">leaderboard</span>Skorları Gör
</button>
<button id="howToPlayBtn" class="btn-secondary btn-animated w-full flex items-center justify-center rounded-xl h-14 px-6 text-lg font-semibold shadow-sm hover:bg-slate-200 transition-colors duration-150">
<span class="material-icons mr-2">help_outline</span>Nasıl Oynanır?
</button>
</div>
</div>
</main>
<footer id="homeFooter" class="bg-white border-t border-slate-200 sticky bottom-0 z-20">
<nav class="container mx-auto px-4 h-16 flex justify-around items-center">
<a id="homeNavHome" href="#" class="flex flex-col items-center justify-center text-slate-500 hover:text-blue-600 transition-colors duration-150 p-2 rounded-lg">
<span class="material-icons">home</span><span class="text-xs font-medium">Ana Sayfa</span>
</a>
<a id="homeNavScores" href="#" class="flex flex-col items-center justify-center text-slate-500 hover:text-blue-600 transition-colors duration-150 p-2 rounded-lg">
<span class="material-icons">bar_chart</span><span class="text-xs font-medium">Skorlar</span>
</a>
<a id="homeNavProfile" href="#" class="flex flex-col items-center justify-center text-slate-500 hover:text-blue-600 transition-colors duration-150 p-2 rounded-lg">
<span class="material-icons">person_outline</span><span class="text-xs font-medium">Profil</span>
</a>
</nav>
</footer>
</div>

<div id="gameScreen" class="main-screen-view hidden flex-col h-full">
<div class="relative flex size-full flex-col bg-white group/design-root overflow-x-hidden lexend-font">
<header class="sticky top-0 z-20 bg-white shadow-sm">
<div class="flex items-center p-4 pb-3 justify-between">
  <button id="closeGameBtn" class="text-gray-700 flex size-10 shrink-0 items-center justify-center rounded-full hover:bg-gray-100 btn-animated">
    <span class="material-icons-outlined">close</span>
  </button>
  <h1 class="text-gray-900 text-xl font-semibold leading-tight tracking-tight text-center">Gerçek mi Sahte mi?</h1>
  <div class="size-10"></div>
</div>
<div class="px-4 pb-3">
<div class="flex items-center justify-between mb-1.5">
<p class="text-gray-700 text-sm font-medium">Soru <span id="currentQuestionDisplay" class="font-bold text-gray-900">1</span>/<span id="totalQuestionsDisplay">7</span></p>
<div class="flex items-center gap-3">
<p class="text-gray-700 text-sm font-medium">Skor: <span id="scoreDisplay" class="font-bold text-gray-900">0</span></p>
<p class="text-gray-700 text-sm font-medium">Seri: <span id="streakCounter" class="font-bold text-gray-900">0</span> 🔥</p>
</div>
</div>
<div class="h-2.5 rounded-full bg-gray-200">
<div id="progressBar" class="h-2.5 rounded-full primary-color-bg transition-all duration-300 ease-out" style="width: 0%;"></div>
</div>
</div>
</header>
<main class="flex-1 overflow-y-auto p-4 flex flex-col items-center justify-center space-y-6">
<div class="flex gap-3 justify-center">
<div class="flex flex-col items-center gap-1.5">
<div class="flex h-12 w-12 sm:h-16 sm:w-16 items-center justify-center rounded-lg bg-gray-100 shadow-inner">
<p id="timerMinutes" class="text-gray-900 text-xl sm:text-2xl font-bold">00</p>
</div><p class="text-gray-600 text-xs font-medium">Dakika</p>
</div>
<div class="flex items-center text-gray-400 text-xl sm:text-2xl font-bold pt-1 pb-5">:</div>
<div class="flex flex-col items-center gap-1.5">
<div class="flex h-12 w-12 sm:h-16 sm:w-16 items-center justify-center rounded-lg bg-gray-100 shadow-inner">
<p id="timerSeconds" class="text-gray-900 text-xl sm:text-2xl font-bold">15</p> </div><p class="text-gray-600 text-xs font-medium">Saniye</p>
</div>
</div>
<div id="newsCardContainer" class="relative w-full max-w-sm sm:max-w-md aspect-[3/4] rounded-2xl shadow-xl">
<div id="swipeRealIndicator" class="swipe-decision-indicator real-indicator">GERÇEK</div>
<div id="swipeFakeIndicator" class="swipe-decision-indicator fake-indicator">SAHTE</div>
<div id="newsCard" class="absolute inset-0 rounded-2xl overflow-hidden bg-slate-200">
<img id="newsImage" alt="Haber Makalesi Resmi" class="absolute inset-0 h-full w-full object-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/>
<div class="absolute inset-0 card-gradient flex flex-col justify-end p-3 sm:p-5 space-y-1 sm:space-y-2">
<h2 id="newsTitle" class="text-white text-xl sm:text-2xl font-bold leading-tight drop-shadow-md">Haber Başlığı</h2>
<p id="newsSnippet" class="text-gray-200 text-xs sm:text-sm font-normal leading-relaxed line-clamp-3 sm:line-clamp-4 drop-shadow-sm">Haber metni...</p>
</div>
</div>
</div>
<div class="text-center text-slate-500 mt-4 text-sm px-4">
Karar vermek için haber kartını <strong>sağa (GERÇEK)</strong> veya <strong>sola (SAHTE)</strong> doğru kaydırın.
</div>
</main>
<nav class="sticky bottom-0 bg-white border-t border-gray-200 pb-safe z-20">
<div class="flex justify-around items-center h-16">
<a id="gameNavHome" href="#" class="flex flex-col items-center justify-center gap-0.5 text-gray-500 hover:primary-color-text transition-colors w-1/3">
<span class="material-icons-outlined text-2xl">cottage</span><span class="text-xs font-medium">Ana Sayfa</span>
</a>
<a id="gameNavGame" href="#" class="flex flex-col items-center justify-center gap-0.5 primary-color-text hover:primary-color-text transition-colors w-1/3">
<span class="material-icons-outlined text-2xl">gamepad</span><span class="text-xs font-medium">Oyun</span>
</a>
<a id="gameNavScores" href="#" class="flex flex-col items-center justify-center gap-0.5 text-gray-500 hover:primary-color-text transition-colors w-1/3">
<span class="material-icons-outlined text-2xl">leaderboard</span><span class="text-xs font-medium">Skorlar</span>
</a>
</div>
</nav>
</div>
</div>

<div id="howToPlayModal" class="fixed inset-0 bg-slate-800 bg-opacity-75 items-center justify-center p-4 hidden z-50">
<div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-auto feedback-content-appear">
<div class="flex justify-between items-center mb-4">
<h3 class="text-2xl font-bold text-slate-800 lexend-font">Nasıl Oynanır?</h3>
<button id="closeModalBtn" class="text-slate-500 hover:text-slate-700 btn-animated">
<span class="material-icons">close</span>
</button>
</div>
<div class="text-slate-600 space-y-3 lexend-font">
<p>Fake or Take?'e hoş geldiniz!</p>
<p>1. Ekranda beliren haber kartını dikkatlice okuyun.</p>
<p>2. Haberin <strong>GERÇEK</strong> olduğuna inanıyorsanız kartı <strong>SAĞA</strong> doğru kaydırın.</p>
<p>3. Haberin <strong>SAHTE</strong> olduğuna inanıyorsanız kartı <strong>SOLA</strong> doğru kaydırın.</p>
<p>Haber okuryazarlığınızı test edin ve ne kadar yüksek puan alabileceğinizi görün!</p>
</div>
</div>
</div>

<div id="timeUpPopup" class="fixed inset-0 bg-slate-800 bg-opacity-75 items-center justify-center p-4 hidden z-40">
<div class="bg-white rounded-lg shadow-xl p-6 sm:p-8 max-w-xs sm:max-w-sm w-full text-center feedback-content-appear">
<span class="material-icons-outlined timeup-icon mb-4" style="font-size: 48px;">timer_off</span>
<h3 class="text-xl sm:text-2xl font-bold text-slate-800 mb-3">Süren Doldu!</h3>
<p class="text-slate-600 mb-6 text-sm sm:text-base">Bu soru için cevap süreniz sona erdi.</p>
<button id="timeUpOkButton" class="w-full rounded-full h-11 px-6 bg-[#0b80ee] text-white text-lg font-semibold hover:bg-[#0968c3] transition-colors btn-animated">Tamam</button>
</div>
</div>

<div id="feedbackScreen" class="main-screen-view hidden bg-slate-50 fixed inset-0 z-30 flex flex-col justify-between overflow-y-auto h-full">
<header class="sticky top-0 z-10 bg-white shadow-sm"> <div class="mx-auto flex max-w-3xl items-center justify-end p-3 sm:p-4"> <button id="closeFeedbackBtn" class="flex items-center justify-center rounded-full text-slate-700 hover:bg-slate-100 p-2 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 btn-animated"> <span class="material-icons-outlined">close</span> </button> </div> </header> <main class="flex-grow px-4 sm:px-6 py-6 sm:py-8"> <div class="mx-auto max-w-md text-center feedback-content-appear"> <div class="mb-6 sm:mb-8"> <span id="feedbackIcon" class="material-icons-outlined" style="font-size: 56px sm:font-size: 64px;"></span> <h2 id="feedbackTitle" class="mt-3 sm:mt-4 text-2xl sm:text-3xl font-bold text-slate-800"></h2> </div> <div id="feedbackBox" class="rounded-lg bg-white p-5 sm:p-6 shadow-lg mb-6 sm:mb-8"> <p id="feedbackText" class="text-slate-700 text-sm sm:text-base leading-relaxed"></p> </div> <div id="feedbackSourceSection" class="hidden rounded-lg bg-white p-5 sm:p-6 shadow-lg text-left"> <h3 class="text-lg sm:text-xl font-semibold text-slate-800 mb-3">Kaynak İncelemesi</h3> <a id="feedbackSourceLinkTag" class="flex items-center gap-3 text-slate-600 hover:text-blue-600 transition-colors group" href="#" target="_blank" rel="noopener noreferrer"> <div class="flex items-center justify-center rounded-lg bg-slate-100 group-hover:bg-blue-50 p-3 shrink-0"> <span class="material-icons-outlined text-slate-500 group-hover:text-blue-500">link</span> </div> <p id="feedbackSourceName" class="text-sm sm:text-base font-medium flex-1 truncate"></p> <span class="material-icons-outlined text-slate-400 group-hover:text-blue-500 text-lg">arrow_forward_ios</span> </a> </div> </div> </main> <footer class="sticky bottom-0 bg-white border-t border-slate-200 p-4"> <div class="mx-auto max-w-md"> <button id="feedbackNextButton" class="w-full flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-12 px-6 bg-[#0b80ee] text-white text-lg font-semibold leading-normal tracking-[0.015em] hover:bg-[#0968c3] transition-colors focus:outline-none focus:ring-2 focus:ring-[#0b80ee] focus:ring-offset-2 btn-animated"> <span class="truncate">Sonraki Soru</span> </button> </div> </footer>
</div>

<div id="resultsScreen" class="main-screen-view hidden bg-slate-50 fixed inset-0 z-30 flex flex-col justify-between overflow-y-auto h-full"> <header class="sticky top-0 z-10 bg-white shadow-sm"> <div class="mx-auto flex max-w-7xl items-center justify-between p-4"> <button id="closeResultsHeaderBtn" class="text-slate-700 hover:text-slate-900 p-2 rounded-full btn-animated"> <span class="material-symbols-outlined">close</span> </button> <h1 class="text-xl font-semibold text-slate-900">Sonuçlar</h1> <div class="w-8 sm:w-10"></div> </div> </header> <main class="flex-1 overflow-y-auto px-6 py-8"> <div class="mx-auto max-w-md text-center"> <div class="mb-8 rounded-xl bg-white p-6 shadow-lg feedback-content-appear"> <h2 class="text-3xl sm:text-4xl font-bold text-slate-800">Skorun: <span id="finalScoreValue" class="text-blue-600">0/0</span></h2> <p class="mt-1 text-slate-600">En Yüksek Skor: <span id="highScoreDisplay" class="font-medium text-slate-700">0/0</span></p> <p class="mt-2 text-slate-600">Harcanan Süre: <span id="timeTakenValue" class="font-medium text-slate-700">0 dakika 0 saniye</span></p> <h4 class="text-lg font-semibold text-slate-700 mt-6 mb-2">Başarımlar</h4> <div id="achievementsDisplay" class="text-sm text-green-600"> </div> </div> <div class="rounded-xl bg-white p-6 shadow-lg"> <div class="flex items-center justify-between mb-6"> <h3 class="text-2xl font-semibold text-slate-800">Liderlik Tablosu</h3> <span class="material-symbols-outlined text-yellow-500 !text-3xl">emoji_events</span> </div> <div class="space-y-4"> <div class="flex items-center justify-between rounded-lg bg-slate-100 p-4 transition-all hover:bg-slate-200"> <div class="flex items-center gap-3"><span class="text-lg font-semibold text-slate-700">1.</span><p class="text-slate-700 font-medium">Oyuncu1 (Bot)</p></div> <p class="font-semibold text-slate-700">7/7</p> </div> <div class="flex items-center justify-between rounded-lg bg-blue-100 p-4 text-blue-700 ring-2 ring-blue-500"> <div class="flex items-center gap-3"><span class="text-lg font-semibold">★</span><p id="yourLeaderboardName" class="font-medium">SEN</p></div> <p id="yourLeaderboardScoreResults" class="font-semibold">0/0</p> </div> </div> </div> </div> </main>
<footer class="sticky bottom-0 bg-white/80 backdrop-blur-md p-4 shadow-[0_-2px_10px_rgba(0,0,0,0.05)]">
  <div class="mx-auto flex max-w-md flex-col gap-3">
    <button id="shareResultsBtn" class="flex h-12 w-full items-center justify-center rounded-full bg-green-500 px-5 text-base font-bold text-white tracking-wide shadow-sm transition-colors hover:bg-green-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-700 btn-animated">
        <span class="material-symbols-outlined mr-2">share</span>Sonucu Paylaş
    </button>
    <button id="playAgainBtn" class="flex h-12 w-full items-center justify-center rounded-full bg-[#dce8f3] px-5 text-base font-bold text-slate-900 tracking-wide shadow-sm transition-colors hover:bg-[#c9d9e9] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#dce8f3] btn-animated">
        <span class="material-symbols-outlined mr-2">replay</span>Tekrar Oyna
    </button>
    <button id="backToHomeResultsBtn" class="flex h-12 w-full items-center justify-center rounded-full bg-slate-200 px-5 text-base font-bold text-slate-700 tracking-wide shadow-sm transition-colors hover:bg-slate-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-slate-400 btn-animated">
        <span class="material-symbols-outlined mr-2">home</span>Ana Sayfaya Dön
    </button>
  </div>
</footer>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
const appRoot = document.getElementById('appRoot');
const homeScreenDiv = document.getElementById('homeScreen');
const playNowButton = document.getElementById('playNowBtn');
const howToPlayButton = document.getElementById('howToPlayBtn');
const leaderboardBtnHome = document.getElementById('leaderboardBtnHome');
const modal = document.getElementById('howToPlayModal');
const closeModalButton = document.getElementById('closeModalBtn');
const gameScreenDiv = document.getElementById('gameScreen');
const closeGameButton = document.getElementById('closeGameBtn');
const currentQuestionDisplay = document.getElementById('currentQuestionDisplay');
const totalQuestionsDisplay = document.getElementById('totalQuestionsDisplay');
const scoreDisplay = document.getElementById('scoreDisplay');
const streakCounter = document.getElementById('streakCounter');
const progressBar = document.getElementById('progressBar');
const timerMinutes = document.getElementById('timerMinutes');
const timerSeconds = document.getElementById('timerSeconds');
const newsCardContainer = document.getElementById('newsCardContainer');
const newsCard = document.getElementById('newsCard');
const newsImage = document.getElementById('newsImage');
const newsTitle = document.getElementById('newsTitle');
const newsSnippet = document.getElementById('newsSnippet');
const swipeRealIndicator = document.getElementById('swipeRealIndicator');
const swipeFakeIndicator = document.getElementById('swipeFakeIndicator');
const timeUpPopup = document.getElementById('timeUpPopup');
const timeUpOkButton = document.getElementById('timeUpOkButton');
const feedbackScreen = document.getElementById('feedbackScreen');
const closeFeedbackBtn = document.getElementById('closeFeedbackBtn');
const feedbackIcon = document.getElementById('feedbackIcon');
const feedbackTitle = document.getElementById('feedbackTitle');
const feedbackBox = document.getElementById('feedbackBox');
const feedbackText = document.getElementById('feedbackText');
const feedbackSourceSection = document.getElementById('feedbackSourceSection');
const feedbackSourceLinkTag = document.getElementById('feedbackSourceLinkTag');
const feedbackSourceName = document.getElementById('feedbackSourceName');
const feedbackNextButton = document.getElementById('feedbackNextButton');
const resultsScreen = document.getElementById('resultsScreen');
const finalScoreValue = document.getElementById('finalScoreValue');
const highScoreDisplay = document.getElementById('highScoreDisplay');
const timeTakenValue = document.getElementById('timeTakenValue');
const achievementsDisplay = document.getElementById('achievementsDisplay');
const playAgainBtn = document.getElementById('playAgainBtn');
const backToHomeResultsBtn = document.getElementById('backToHomeResultsBtn');
const closeResultsHeaderBtn = document.getElementById('closeResultsHeaderBtn');
const yourLeaderboardScoreResults = document.getElementById('yourLeaderboardScoreResults');
const shareResultsBtn = document.getElementById('shareResultsBtn'); // Share button
const homeNavHome = document.getElementById('homeNavHome');
const homeNavScores = document.getElementById('homeNavScores');
const homeNavProfile = document.getElementById('homeNavProfile');
const gameNavHome = document.getElementById('gameNavHome');
const gameNavGame = document.getElementById('gameNavGame');
const gameNavScores = document.getElementById('gameNavScores');

if (!appRoot || !homeScreenDiv || !gameScreenDiv || !newsCard || !newsCardContainer || !modal || !timeUpPopup || !feedbackScreen || !resultsScreen) {
console.error("Kritik HTML elementlerinden biri veya birkaçı DOM'da bulunamadı! Lütfen ID'leri kontrol edin.");
if(document.body) document.body.innerHTML = "<p style='color:red; text-align:center; font-size:20px; margin-top:50px;'>Kritik bir hata oluştu. Lütfen geliştirici konsolunu kontrol edin.</p>";
return;
}

const newsData = [
{
id: 1,
title: "Düğün konvoyunun yolunu İHA ile kestiler!",
snippet: "Sakarya’nın Arifiye ilçesinde TEKNOFEST’e hazırlanan üniversiteli gençler, geliştirdikleri İnsansız Hava Aracı (İHA) ile sıra dışı bir geleneğe imza attı.",
image: "https://i.ibb.co/2YZS2NvT/image.png",
link: "https://www.milliyet.com.tr/gundem/dugun-konvoyunu-iha-ile-kestiler-boyle-yol-kesme-gelenegi-gorulmedi-7377522",
isReal: true,
explanation: "Valla gerçek! Sakarya'da üniversiteli gençler TEKNOFEST için yaptıkları İHA ile 'Durun bakalım, önce bizim bahşiş!' demişler resmen. Teknoloji ve gelenek böyle de birleşiyormuş demek ki, helal olsun gençlerimize.",
displaySourceName: "Milliyet",
displaySourceLink: "https://www.milliyet.com.tr/gundem/dugun-konvoyunu-iha-ile-kestiler-boyle-yol-kesme-gelenegi-gorulmedi-7377522"
},
{
id: 2,
title: "Etiyopyalı kabileye kebabı sevdiren Bursalı!",
snippet: "Keçiden Adana yapınca kabile ayağa kalktı, o günden beri herkes ona “enişte” diyor.",
image: "https://i.ibb.co/mVmKVnC0/Screenshot-2025-05-25-at-16-12-45.png",
link: "https://www.milliyet.com.tr/pembenar/etiyopyali-kabileye-kebabi-sevdiren-bursali-bana-herkes-burada-eniste-diyor-7368262",
isReal: true,
explanation: "Bu da gerçek çıktı! Bursalı bir aşçı almış eline satırı, Etiyopya'da bir kabileyi Adana kebabıyla tanıştırmış. Kabile o kadar beğenmiş ki, bizimkine 'enişte' demeye başlamışlar. Düşünsene, Etiyopya'da 'Enişte, bir Adana çek!' diyorlar.",
displaySourceName: "Milliyet",
displaySourceLink: "https://www.milliyet.com.tr/pembenar/etiyopyali-kabileye-kebabi-sevdiren-bursali-bana-herkes-burada-eniste-diyor-7368262"
},
{
  id: 3,
  title: "Muhtar, Köyde Yapay Zekâ ile Düğün Organize Etti: 'Davulcuya Gerek Kalmadı!'",
  snippet: "Çorum'un Bayat ilçesine bağlı bir köyde muhtar, köydeki genç çift için ChatGPT'den düğün organizasyonu planladı. Halay sırasını bile yapay zekâ belirledi.",
  image: "https://i.ibb.co/4RZqspXY/image.png",
  link: "#muhtar-chatgpt-dugun",
  isReal: false,
  explanation: "Yok artık, bu tamamen uydurma! Çorum'da muhtar ChatGPT'ye düğün planlatmış da, halay sırasını bile o belirlemiş falan... Kulağa komik geliyor ama maalesef (ya da neyse ki) böyle bir şey yaşanmamış. Sosyal medyada geyiği dönmüştür kesin, ama haber değeri yok, sallamasyon."
},
{
id: 4,
title: "BYD'nin en büyüğü Tang tam 7 Kişilikmiş! ",
snippet: "Geniş İç Hacmi Görenleri Şaşırtan araca tam 7 kişilik bir aile rahatça sığabilen araç 'bu kadar da rahat olur mu?' dedirtiyor.",
image: "https://i.ibb.co/mFSdLh8X/image.png",
link: "^byd-tang",
isReal: true,
explanation: "Evet, bu haber gerçekten doğru! BYD'nin Tang modeli tam 7 koltuklu ve içi acayip geniş, yani büyük aileler ya da arkadaş grupları için süper rahat. Elektrikli olması, havalı tasarımı ve teknolojik sürüş özellikleriyle Tang, Türkiye'deki SUV'lara yeni bir soluk getiriyor. ",
displaySourceName: "Hemen Keşfet!",
displaySourceLink: "https://www.bydauto.com.tr/tang"
},
{
  id: 5,
  title: "İstanbul'da Yeni Trafik Uygulaması: Korna Fazla Basana Ehliyet Dondurma Cezası!",
  snippet: "İBB'nin başlattığı pilot uygulamada, trafikte 3 saniyeden uzun süre korna çalan sürücülerin ehliyetine 1 hafta el konuluyor. Tepkiler karışık.",
  image: "https://i.ibb.co/RpB72wQm/image.png",
  link: "#korna-cezasi-kurgu",
  isReal: false,
  explanation: "Keşke gerçek olsa diyenler olabilir ama bu haber de maalesef gerçek değil. İstanbul trafiğinde kornaya abananın ehliyetine el koymak... Güzel fikir ama şimdilik sadece hayal. Olsa kimse şaşırmazdı o ayrı konu tabii, o kornalarla az çekmedik!"
}
,
{ id: 6, title: "Ankara'da 3+1 Diye Aldığı Daire, 1+1 Çıktı!", snippet: "Almanya’da yaşayan Mehmet Ü., Ankara’da 140 metrekare olarak satın aldığı dairenin aslında 78 metrekare ve 1+1 olduğunu fark edince şoke oldu. Konuyla ilgili dava açıldı.", image: "https://i.ibb.co/MxBPdvqN/image.png", link: "https://www.ensonhaber.com/3-sayfa/ankarada-31-diye-aldigi-daire-11-cikti", isReal: true, explanation: "Ah be Mehmet abi! Bu haber maalesef gerçek. Almanya'dan gelip Ankara'da 'Geniş geniş otururum' diye aldığı ev, kuş yuvası çıkmış resmen. 3+1 diye al, 1+1 çıksın... Tam 'Türkiye'de emlakçılık' fıkrası gibi ama yaşanmış. Basında da bayağı konuşuldu bu olay." ,
displaySourceName: "Hürriyet",
displaySourceLink: "https://www.hurriyet.com.tr/gundem/4-yil-sonra-ogrendi-hayatinin-sokunu-yasadi-3-1-olarak-satin-aldigi-ev-1-1-cikti-42788236"}
,
{ id: 7, title: "Denizli Honaz Belediyesi, Şehir Sakinlerini Uyanmak İçin Yeni Horoz Uygulamasıyla Tanıştırdı!", snippet: "Uykucu vatandaşlara doğal çözüm: Belediye, sabahları klasik alarm seslerinden şikayet edenler için 'horozlu uyandırma hizmeti' başlattı. Gerçek horozlar, belirlenen adreslere sabah 06.30’da götürülüyor.", image: "https://i.ibb.co/qQ9kDcB/image.png", link: "#horozlu-uyandirici", isReal: false, explanation: "Hahaha, bu çok iyiymiş ama tabii ki uydurma! Denizli'de belediye 'Alarmla uyanamayanlara horoz yolluyoruz' dese ortalık yıkılırdı herhalde. Sabahın köründe kapına horoz gelmesi... Mizah sitelerinde falan döner anca böyle şeyler, gerçek hayatta yok (şimdilik!)." },
{ id: 8, title: "Sivaslı Çiftçi, 9 Deve Kuşu Alarak Babasının Hayalini Gerçekleştirdi", snippet: "Sivas'ta yaşayan Berat Öksüz, babasının yıllar önceki deve kuşu besleme hayalini gerçekleştirdi. 'Bayağı şaşıran oluyor çünkü Sivas’ta görmedikleri bir şey' diyerek duygularını paylaştı.", image: "https://i.ibb.co/YTwYG3LT/image.png", link: "https://www.ensonhaber.com/3-sayfa/sivasli-ciftci-babasinin-hayalini-gerceklestirdi", isReal: true, explanation: "Bu da capcanlı gerçek! Sivaslı bir çiftçi, babasının 'Ah bir deve kuşu çiftliğim olsa' hayalini gerçekleştirmiş. Yiğidin harman olduğu yerde deve kuşu ne arar demeyin, Sivaslı şaşırtmayı sever. Adam yapmış valla, görenler de 'Vay be!' diyormuş.",displaySourceName: "En Son Haber",
displaySourceLink: "https://www.ensonhaber.com/3-sayfa/sivasli-ciftci-babasinin-hayalini-gerceklestirdi" }
];

let currentQuestionIndex = 0; let score = 0; let currentStreak = 0;
let timerInterval; let timeLeft = 15; const TIME_PER_QUESTION = 15;
let gameStartTime; let gamePlayedAtLeastOnce = false;
let achievements = JSON.parse(localStorage.getItem('fakeOrTakeAchievements_tr')) || { playedFirstGame: false, fiveInARow: false, scoreOver70Percent: false };

let isSwiping = false; let isMouseSwiping = false;
let swipeStartX = 0; let swipeCurrentX = 0;
const SWIPE_THRESHOLD = 70;
const CARD_MAX_ROTATION = 20;
const CARD_ROTATION_FACTOR = CARD_MAX_ROTATION / 160;
let animateInTimeoutId = null;
let timeUpAutoCloseTimeoutId = null;

function saveAchievements() { localStorage.setItem('fakeOrTakeAchievements_tr', JSON.stringify(achievements)); }
function unlockAchievement(id, msg) { if (!achievements[id]) { achievements[id] = true; saveAchievements(); console.log(`Başarı: ${msg}`);}}
function displayUnlockedAchievements() { if (!achievementsDisplay) return; achievementsDisplay.innerHTML = ''; let count = 0; if(achievements.playedFirstGame){ achievementsDisplay.innerHTML += '<p class="text-sm">🏅 İlk Oyun Tamamlandı!</p>'; count++;} if(achievements.fiveInARow){ achievementsDisplay.innerHTML += '<p class="text-sm">🔥 Seri Uzmanı (5 Doğru)!</p>'; count++;} if(achievements.scoreOver70Percent){ achievementsDisplay.innerHTML += '<p class="text-sm">🏆 Yüksek Skorlu Oyuncu!</p>'; count++;} if(count === 0) achievementsDisplay.innerHTML = '<p class="text-sm text-slate-500">Henüz bir başarım kazanmadın.</p>'; }
function updateActiveNav(activeId) { const navs = [ { el: homeNavHome, id: 'homeScreen' }, { el: homeNavScores, id: 'resultsScreen' }, { el: homeNavProfile, id: 'profileScreen' }, { el: gameNavHome, id: 'homeScreen' }, { el: gameNavGame, id: 'gameScreen' }, { el: gameNavScores, id: 'resultsScreen' } ]; navs.forEach(n => { if(n.el) { n.el.classList.toggle('nav-item-active', n.id === activeId); }}); if (activeId === 'homeScreen' && homeNavHome) homeNavHome.classList.add('nav-item-active'); else if (homeNavHome) homeNavHome.classList.remove('nav-item-active'); if (activeId === 'gameScreen' && gameNavGame) gameNavGame.classList.add('nav-item-active'); else if (gameNavGame) gameNavGame.classList.remove('nav-item-active'); if (activeId === 'resultsScreen') { if(homeNavScores) homeNavScores.classList.add('nav-item-active'); if(gameNavScores) gameNavScores.classList.add('nav-item-active'); } else { if(homeNavScores) homeNavScores.classList.remove('nav-item-active'); if(gameNavScores) gameNavScores.classList.remove('nav-item-active'); } }
function showScreen(screen) { const allScreens = [homeScreenDiv, gameScreenDiv, feedbackScreen, resultsScreen]; const allPopups = [timeUpPopup, modal]; allScreens.forEach(s => { if (s) { s.classList.add('hidden'); s.classList.remove('flex'); }}); allPopups.forEach(p => { if (p) { p.classList.add('hidden'); p.classList.remove('flex'); }}); if(screen){ screen.classList.remove('hidden'); if (allScreens.includes(screen) || allPopups.includes(screen)) { screen.classList.add('flex');} if (allScreens.includes(screen)) { updateActiveNav(screen.id); }} else { updateActiveNav(null); } if (!allPopups.includes(screen) && screen !== modal) { window.scrollTo(0,0); }}

function resetCardState(isNewCard = false) { if (!newsCard || !swipeRealIndicator || !swipeFakeIndicator) return; newsCard.classList.remove('fly-out-left', 'fly-out-right', 'enter-anim', 'active', 'swiping'); newsCard.style.animation = ''; if (isNewCard) { newsCard.classList.add('enter-anim'); newsCard.style.opacity = '0'; newsCard.style.transform = 'translateY(60px) scale(0.95) rotateX(-15deg)'; } else { newsCard.style.transition = 'transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1)'; newsCard.style.transform = 'translateX(0px) rotate(0deg)'; newsCard.style.opacity = '1'; newsCard.style.visibility = 'visible'; } swipeRealIndicator.classList.remove('visible'); swipeFakeIndicator.classList.remove('visible');}
function animateCardIn() { if (!newsCard) return; void newsCard.offsetWidth; newsCard.classList.add('active'); }

function updateUIForNewQuestion() {
    if (!newsCard || !newsImage || !newsTitle || !newsSnippet || !currentQuestionDisplay || !totalQuestionsDisplay || !progressBar || !streakCounter || !timerSeconds) return;
    resetCardState(true);
    if (currentQuestionIndex >= newsData.length) {
        endGame();
        return;
    }
    const question = newsData[currentQuestionIndex];

    if (animateInTimeoutId) {
        clearTimeout(animateInTimeoutId);
        animateInTimeoutId = null;
    }

    if (newsImage) newsImage.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";

    if (newsImage && question.image) {
        newsImage.src = question.image;
        newsImage.onload = () => {
            animateInTimeoutId = setTimeout(animateCardIn, 50);
        };
        newsImage.onerror = () => {
            console.warn("Haber resmi yüklenemedi:", question.image);
            newsImage.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
            animateInTimeoutId = setTimeout(animateCardIn, 50);
        };
    } else {
        animateInTimeoutId = setTimeout(animateCardIn, 50);
    }
    newsTitle.textContent = question.title;
    newsSnippet.textContent = question.snippet;
    currentQuestionDisplay.textContent = currentQuestionIndex + 1;
    totalQuestionsDisplay.textContent = newsData.length;
    streakCounter.textContent = currentStreak;
    progressBar.style.width = `${((currentQuestionIndex) / newsData.length) * 100}%`;
    timerSeconds.classList.remove('timer-pulse', 'text-red-500'); // GÜNCELLENDİ: Kırmızı renk sınıfı temizleniyor
}

function startTimer() {
    if(!timerSeconds || !timerMinutes) return;
    timeLeft = TIME_PER_QUESTION;
    timerSeconds.textContent = timeLeft < 10 ? `0${timeLeft}` : timeLeft;
    timerMinutes.textContent = "00";
    timerSeconds.classList.remove('timer-pulse', 'text-red-500'); // GÜNCELLENDİ: Temizlik
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        timeLeft--;
        timerSeconds.textContent = timeLeft < 10 ? `0${timeLeft}` : timeLeft;

        if (timeLeft <= 5 && timeLeft > 0) { // 5 saniye ve altı (0 hariç) için pulse
            timerSeconds.classList.add('timer-pulse');
        } else {
            timerSeconds.classList.remove('timer-pulse');
        }

        if (timeLeft < 5) { // 4 saniye ve altı için kırmızı renk (0 dahil)
            timerSeconds.classList.add('text-red-500'); // Tailwind red-500 (veya -600)
        } else {
            timerSeconds.classList.remove('text-red-500');
        }

        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            // showTimeUpPopup çağrılmadan önce pulse ve renk temizliği gerekmeyebilir,
            // çünkü showTimeUpPopup sonrası handleAnswer -> proceedToNextStep -> updateUIForNewQuestion ile temizlenecek.
            showTimeUpPopup();
        }
    }, 1000);
}

function showTimeUpPopup() {
    if (!timeUpPopup) return;
    showScreen(timeUpPopup);

    if (timeUpAutoCloseTimeoutId) {
        clearTimeout(timeUpAutoCloseTimeoutId);
    }

    timeUpAutoCloseTimeoutId = setTimeout(() => {
        if (timeUpPopup && !timeUpPopup.classList.contains('hidden')) {
            handleAnswer(null);
        }
    }, 1200);
}

if (timeUpOkButton) {
    timeUpOkButton.addEventListener('click', () => {
        if (timeUpAutoCloseTimeoutId) {
            clearTimeout(timeUpAutoCloseTimeoutId);
            timeUpAutoCloseTimeoutId = null;
        }
        handleAnswer(null);
    });
}

function processSwipeDecision(isRealChoice) { if(!newsCard || !swipeRealIndicator || !swipeFakeIndicator) return; newsCard.style.transition = 'none'; if (isRealChoice) { newsCard.classList.add('fly-out-right'); swipeRealIndicator.classList.add('visible'); } else { newsCard.classList.add('fly-out-left'); swipeFakeIndicator.classList.add('visible'); } setTimeout(() => { handleAnswer(isRealChoice); }, 400); }

function handleAnswer(userChoiceIsReal) {
    if (!scoreDisplay || !feedbackTitle || !feedbackIcon || !feedbackBox || !feedbackText || !feedbackSourceSection || !feedbackSourceName || !feedbackSourceLinkTag || !streakCounter || !timerSeconds) return;
    clearInterval(timerInterval);
    if(timerSeconds) {
        timerSeconds.classList.remove('timer-pulse', 'text-red-500'); // GÜNCELLENDİ
    }

    if (timeUpAutoCloseTimeoutId) {
        clearTimeout(timeUpAutoCloseTimeoutId);
        timeUpAutoCloseTimeoutId = null;
    }

    const currentQuestion = newsData[currentQuestionIndex];
    const wasCorrect = userChoiceIsReal === currentQuestion.isReal;

    if (userChoiceIsReal !== null && wasCorrect) {
        score++;
        currentStreak++;
        if (currentStreak === 5) {
            unlockAchievement('fiveInARow', "Harika Seri! (5 doğru)");
        }
    } else if (userChoiceIsReal !== null && !wasCorrect) {
        currentStreak = 0;
    }
    if(userChoiceIsReal === null) currentStreak = 0;

    scoreDisplay.textContent = score;
    streakCounter.textContent = currentStreak;

    feedbackIcon.className = "material-icons-outlined feedback-content-appear";
    feedbackBox.className = "rounded-lg bg-white p-5 sm:p-6 shadow-lg mb-6 sm:mb-8 feedback-content-appear";
    feedbackTitle.classList.add("feedback-content-appear");
    feedbackSourceSection.classList.add('hidden');

    let feedbackStr = "";

    if (userChoiceIsReal === null) {
        feedbackTitle.textContent = "Süre Bitti!";
        feedbackIcon.textContent = "timer_off";
        feedbackIcon.classList.add('timeup-icon');
        feedbackBox.classList.add('incorrect-feedback');
        feedbackStr = `Bu soru için süreniz doldu. Doğru cevap: <strong>${currentQuestion.isReal ? 'GERÇEK' : 'SAHTE'}</strong> idi.<br><br>${currentQuestion.explanation || ''}`;
    } else if (wasCorrect) {
        feedbackTitle.textContent = "Bildin!";
        feedbackIcon.textContent = "check_circle";
        feedbackIcon.classList.add('status-icon-correct');
        feedbackBox.classList.add('correct-feedback');
        feedbackStr = currentQuestion.explanation || (currentQuestion.isReal ? "Bu haber gerçekten doğru." : "Bu haberin sahte olduğunu doğru tespit ettin.");
    } else {
        feedbackTitle.textContent = "Tekrar dene!";
        feedbackIcon.textContent = "cancel";
        feedbackIcon.classList.add('status-icon-incorrect');
        feedbackBox.classList.add('incorrect-feedback');
        feedbackStr = `Doğru cevap <strong>${currentQuestion.isReal ? 'GERÇEK' : 'SAHTE'}</strong> olmalıydı.<br><br>${currentQuestion.explanation || ''}`;
    }

    feedbackText.innerHTML = feedbackStr;

    if (currentQuestion.displaySourceName && currentQuestion.displaySourceLink) {
        feedbackSourceName.textContent = currentQuestion.displaySourceName;
        feedbackSourceLinkTag.href = currentQuestion.displaySourceLink;
        feedbackSourceSection.classList.remove('hidden');
    }

    feedbackNextButton.textContent = (currentQuestionIndex >= newsData.length - 1) ? "Sonuçları Gör" : "Sonraki Soru";
    showScreen(feedbackScreen);
}

function proceedToNextStep() { if (!progressBar) return; currentQuestionIndex++; progressBar.style.width = `${(currentQuestionIndex / newsData.length) * 100}%`; if (currentQuestionIndex < newsData.length) { showScreen(gameScreenDiv); updateUIForNewQuestion(); startTimer(); } else { endGame(); }}
if(feedbackNextButton) feedbackNextButton.addEventListener('click', proceedToNextStep);
if(closeFeedbackBtn) closeFeedbackBtn.addEventListener('click', proceedToNextStep);

function startGame() { if (!scoreDisplay || !totalQuestionsDisplay || !progressBar || !streakCounter) { console.error("Oyun başlatma için UI elementleri eksik"); return; } gameStartTime = Date.now(); currentQuestionIndex = 0; score = 0; currentStreak = 0; scoreDisplay.textContent = score; streakCounter.textContent = currentStreak; totalQuestionsDisplay.textContent = newsData.length; progressBar.style.width = '0%'; unlockAchievement('playedFirstGame', "İlk Oyun!"); showScreen(gameScreenDiv); updateUIForNewQuestion(); startTimer(); }

let gameEndTimeVariable;
function endGame() {
    if (!timeTakenValue || !finalScoreValue || !yourLeaderboardScoreResults || !highScoreDisplay) return;
    gamePlayedAtLeastOnce = true;
    clearInterval(timerInterval);
    if(timerSeconds) {
        timerSeconds.classList.remove('timer-pulse', 'text-red-500'); // GÜNCELLENDİ
    }
    gameEndTimeVariable = Date.now();
    const timeDiff = gameEndTimeVariable - gameStartTime;
    const mins = Math.floor(timeDiff / 60000);
    const secs = Math.floor((timeDiff % 60000) / 1000);
    timeTakenValue.textContent = `${mins} dakika ${secs} saniye`;
    finalScoreValue.textContent = `${score}/${newsData.length}`;
    yourLeaderboardScoreResults.textContent = `${score}/${newsData.length}`;
    let hs = parseInt(localStorage.getItem('fakeOrTakeHighScore_tr')) || 0;
    if (score > hs) { hs = score; localStorage.setItem('fakeOrTakeHighScore_tr', hs); }
    highScoreDisplay.textContent = `${hs}/${newsData.length}`;
    if (newsData.length > 0 && score / newsData.length >= 0.7) { unlockAchievement('scoreOver70Percent', "Yüksek Skorlu Oyuncu!"); }
    displayUnlockedAchievements();
    showScreen(resultsScreen);
}

function resetGame() {
    clearInterval(timerInterval);
    if(timerSeconds) {
        timerSeconds.classList.remove('timer-pulse', 'text-red-500'); // GÜNCELLENDİ
    }
}
function navigateToHome() { resetGame(); showScreen(homeScreenDiv); }
function navigateToResults() {
    // Eğer oyun bitmediyse ve skorlar sayfasına doğrudan geçiliyorsa, mevcut oyunu bitir.
    // Bu, örneğin oyun sırasında skorlar nav ikonuna basılırsa senaryosu için.
    // Ama şu anki akışta bu doğrudan olmaz, endGame zaten çağrılır.
    // Eğer emin olmak isterseniz: if (!resultsScreen.classList.contains('flex')) endGame();
    showScreen(resultsScreen);
}


function unifiedSwipeStart(e) {
    if (!newsCard || newsCard.classList.contains('fly-out-left') || newsCard.classList.contains('fly-out-right')) return;
    if (animateInTimeoutId) { clearTimeout(animateInTimeoutId); animateInTimeoutId = null; }
    if (newsCard.classList.contains('enter-anim') || (newsCard.style.animation && newsCard.style.animation !== 'none')) {
        newsCard.classList.remove('enter-anim', 'active');
        newsCard.style.animation = 'none';
    }
    newsCard.style.opacity = '1'; newsCard.style.transform = '';
    isSwiping = true; isMouseSwiping = (e.type === 'mousedown');
    swipeStartX = isMouseSwiping ? e.pageX : e.touches[0].pageX;
    newsCard.style.transition = 'none'; newsCard.classList.add('swiping');
    if (isMouseSwiping) { document.addEventListener('mousemove', unifiedSwipeMove); document.addEventListener('mouseup', unifiedSwipeEnd); }
}

function unifiedSwipeMove(e) {
    if (!isSwiping || !newsCard) return;
    swipeCurrentX = isMouseSwiping ? e.pageX : e.touches[0].pageX;
    let diffX = swipeCurrentX - swipeStartX;
    if (e.type === 'touchmove' && Math.abs(diffX) > 5 && e.cancelable) { e.preventDefault(); }
    let rotation = diffX * CARD_ROTATION_FACTOR;
    rotation = Math.max(-CARD_MAX_ROTATION, Math.min(CARD_MAX_ROTATION, rotation));
    const newTransform = `translateX(${diffX}px) rotate(${rotation}deg)`;
    requestAnimationFrame(() => { if (isSwiping) { newsCard.style.transform = newTransform; } });
    if (diffX > SWIPE_THRESHOLD / 1.8) { swipeRealIndicator.classList.add('visible'); swipeFakeIndicator.classList.remove('visible');
    } else if (diffX < -SWIPE_THRESHOLD / 1.8) { swipeFakeIndicator.classList.add('visible'); swipeRealIndicator.classList.remove('visible');
    } else { swipeRealIndicator.classList.remove('visible'); swipeFakeIndicator.classList.remove('visible'); }
}
function unifiedSwipeEnd(e) {
    if (!isSwiping || !newsCard) return;
    if (isMouseSwiping) { document.removeEventListener('mousemove', unifiedSwipeMove); document.removeEventListener('mouseup', unifiedSwipeEnd); }
    isSwiping = false; isMouseSwiping = false; newsCard.classList.remove('swiping');
    let diffX = swipeCurrentX - swipeStartX;
    if (Math.abs(diffX) > SWIPE_THRESHOLD) {
        if (diffX > 0) { swipeRealIndicator.classList.add('visible'); } else { swipeFakeIndicator.classList.add('visible'); }
        processSwipeDecision(diffX > 0);
    } else { resetCardState(false); }
    swipeStartX = 0; swipeCurrentX = 0;
}
if (newsCard) {
    newsCard.addEventListener('mousedown', unifiedSwipeStart);
    newsCard.addEventListener('touchstart', unifiedSwipeStart, { passive: true });
    newsCard.addEventListener('touchmove', unifiedSwipeMove, { passive: false });
    newsCard.addEventListener('touchend', unifiedSwipeEnd);
    newsCard.addEventListener('touchcancel', unifiedSwipeEnd);
} else { console.error("Haber kartı (newsCard) DOM'da bulunamadı! Swipe çalışmayacak."); }

async function handleShareResults() {
    if (!newsData || newsData.length === 0) {
        alert("Paylaşılacak bir sonuç bulunamadı.");
        return;
    }
    const shareText = `Fake or Take?'de ${score}/${newsData.length} yaptım! Sen de bu haberlerin gerçek mi sahte mi olduğunu tahmin etmeye çalış. Challenge'a var mısın? 😎`;
    const shareUrl = window.location.href;
    const shareTitle = "Fake or Take? - Skor Yarışması!";

    if (navigator.share) {
        try {
            await navigator.share({ title: shareTitle, text: shareText, url: shareUrl });
            console.log('Sonuç başarıyla paylaşıldı!');
        } catch (error) {
            console.error('Paylaşım sırasında hata oluştu:', error);
        }
    } else {
        try {
            await navigator.clipboard.writeText(`${shareTitle}\n${shareText}\n${shareUrl}`);
            alert('Paylaşım özelliği bu tarayıcıda desteklenmiyor. Skorun ve davet mesajın panoya kopyalandı, istediğin yerde paylaşabilirsin!');
        } catch (err) {
            alert('Paylaşım özelliği bu tarayıcıda desteklenmiyor ve metin panoya kopyalanamadı. Lütfen skoru manuel olarak paylaşın.');
            console.error('Panoya kopyalama başarısız:', err);
        }
    }
}

// Diğer Event Listeners
if (howToPlayButton && modal && closeModalButton) { howToPlayButton.addEventListener('click', () => { if (modal) { showScreen(modal); }}); const closeHowToPlayModalAndGoHome = () => { navigateToHome(); }; closeModalButton.addEventListener('click', closeHowToPlayModalAndGoHome); modal.addEventListener('click', (event) => { if (event.target === modal) { closeHowToPlayModalAndGoHome(); }}); } else { console.error("Modal ('Nasıl Oynanır') elementleri bulunamadı."); }
if (playNowButton) { playNowButton.addEventListener('click', startGame); } else { console.error('Hemen Oyna butonu (playNowBtn) bulunamadı!'); }
if (closeGameButton) { closeGameButton.addEventListener('click', navigateToHome); } else { console.error('Oyun Kapatma butonu (closeGameBtn) bulunamadı!'); }

if(shareResultsBtn) shareResultsBtn.addEventListener('click', handleShareResults);
if(playAgainBtn) playAgainBtn.addEventListener('click', startGame);
if(backToHomeResultsBtn) backToHomeResultsBtn.addEventListener('click', navigateToHome);
if(closeResultsHeaderBtn) closeResultsHeaderBtn.addEventListener('click', navigateToHome);
if(homeNavHome) homeNavHome.addEventListener('click', (e) => { e.preventDefault(); navigateToHome();});
if(homeNavScores) homeNavScores.addEventListener('click', (e) => { e.preventDefault(); navigateToResults();});
if(leaderboardBtnHome) leaderboardBtnHome.addEventListener('click', (e) => { e.preventDefault(); navigateToResults();});
if(gameNavHome) gameNavHome.addEventListener('click', (e) => { e.preventDefault(); navigateToHome();});
if(gameNavScores) gameNavScores.addEventListener('click', (e) => { e.preventDefault(); navigateToResults();});

displayUnlockedAchievements();
showScreen(homeScreenDiv);
if(document.body) document.body.classList.remove('loading');

});
</script>
</body>
</html>
